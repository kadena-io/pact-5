{"module":{"hash":"GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY","blessed":[],"interfaces":[],"imports":[],"name":{"namespace":"util","name":"guards1"},"code":"(module guards1 'util-ns-admin\n  \"************************WARNING************************\\\n  \\ This module is currently governed by 'util-ns-admin   \\\n  \\ and should not be in use until the governance is      \\\n  \\ replaced with AUTONOMOUS, meaning that the module     \\\n  \\ will be non-upgradable.                               \\\n  \\ ******************************************************\\\n  \\ Functions for implementing gas guards.\"\n\n;  (defcap AUTONOMOUS ()\n;    (enforce false \"Non-upgradeable\"))\n\n  (defun guard-all:guard (guards:[guard])\n    \"Create a guard that only succeeds if every guard in GUARDS is successfully enforced.\"\n    (enforce (< 0 (length guards)) \"Guard list cannot be empty\")\n    (create-user-guard (enforce-guard-all guards)))\n\n  (defun enforce-guard-all:bool (guards:[guard])\n    \"Enforces all guards in GUARDS\"\n    (map (enforce-guard) guards)\n    true\n  )\n\n  (defun guard-any:guard (guards:[guard])\n    \"Create a guard that succeeds if at least one guard in GUARDS is successfully enforced.\"\n    (enforce (< 0 (length guards)) \"Guard list cannot be empty\")\n    (create-user-guard (enforce-guard-any guards)))\n\n  (defun enforce-guard-any:bool (guards:[guard])\n    \"Will succeed if at least one guard in GUARDS is successfully enforced.\"\n    (enforce (< 0\n      (length\n        (filter\n          (= true)\n          (map (try-enforce-guard) guards))))\n      \"None of the guards passed\")\n  )\n\n  (defun try-enforce-guard (g:guard)\n    (try false (enforce-guard g))\n  )\n\n  (defun max-gas-notional:guard (gasNotional:decimal)\n    \"Guard to enforce gas price * gas limit is smaller than or equal to GAS\"\n    (create-user-guard\n      (enforce-below-or-at-gas-notional gasNotional)))\n\n  (defun enforce-below-gas-notional (gasNotional:decimal)\n    (enforce (< (chain-gas-notional) gasNotional)\n      (format \"Gas Limit * Gas Price must be smaller than {}\" [gasNotional])))\n\n  (defun enforce-below-or-at-gas-notional (gasNotional:decimal)\n    (enforce (<= (chain-gas-notional) gasNotional)\n      (format \"Gas Limit * Gas Price must be smaller than or equal to {}\" [gasNotional])))\n\n  (defun max-gas-price:guard (gasPrice:decimal)\n    \"Guard to enforce gas price is smaller than or equal to GAS PRICE\"\n    (create-user-guard\n      (enforce-below-or-at-gas-price gasPrice)))\n\n  (defun enforce-below-gas-price:bool (gasPrice:decimal)\n    (enforce (< (chain-gas-price) gasPrice)\n      (format \"Gas Price must be smaller than {}\" [gasPrice])))\n\n  (defun enforce-below-or-at-gas-price:bool (gasPrice:decimal)\n    (enforce (<= (chain-gas-price) gasPrice)\n      (format \"Gas Price must be smaller than or equal to {}\" [gasPrice])))\n\n  (defun max-gas-limit:guard (gasLimit:integer)\n    \"Guard to enforce gas limit is smaller than or equal to GAS LIMIT\"\n    (create-user-guard\n      (enforce-below-or-at-gas-limit gasLimit)))\n\n  (defun enforce-below-gas-limit:bool (gasLimit:integer)\n    (enforce (< (chain-gas-limit) gasLimit)\n      (format \"Gas Limit must be smaller than {}\" [gasLimit])))\n\n  (defun enforce-below-or-at-gas-limit:bool (gasLimit:integer)\n    (enforce (<= (chain-gas-limit) gasLimit)\n      (format \"Gas Limit must be smaller than or equal to {}\" [gasLimit])))\n\n  (defun chain-gas-price ()\n    \"Return gas price from chain-data\"\n    (at 'gas-price (chain-data)))\n\n  (defun chain-gas-limit ()\n    \"Return gas limit from chain-data\"\n    (at 'gas-limit (chain-data)))\n\n  (defun chain-gas-notional ()\n    \"Return gas limit * gas price from chain-data\"\n    (* (chain-gas-price) (chain-gas-limit)))\n)\n","meta":{"model":[],"docs":"************************WARNING************************ This module is currently governed by 'util-ns-admin    and should not be in use until the governance is       replaced with AUTONOMOUS, meaning that the module      will be non-upgradable.                                ****************************************************** Functions for implementing gas guards."},"governance":{"keyset":"util-ns-admin"}},"refMap":{"enforce-guard-all":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"guards","type":{"list":{"guard":null}},"info":null}],"return":"bool"},"defName":"enforce-guard-all","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Enforces all guards in GUARDS"},"info":null}},"chain-gas-limit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"k","constraint":[]}},"defName":"chain-gas-limit","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":"gas-limit"},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"chain-data"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Return gas limit from chain-data"},"info":null}},"enforce-below-or-at-gas-notional":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasNotional","type":"decimal","info":null}],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"enforce-below-or-at-gas-notional","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.chain-gas-notional.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"Gas Limit * Gas Price must be smaller than or equal to {}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"e","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":null},"info":null}},"chain-gas-price":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"j","constraint":[]}},"defName":"chain-gas-price","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":"gas-price"},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"chain-data"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Return gas price from chain-data"},"info":null}},"enforce-guard-any":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"guards","type":{"list":{"guard":null}},"info":null}],"return":"bool"},"defName":"enforce-guard-any","defBody":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":{"int":0}},{"args":[{"args":[{"args":[{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.try-enforce-guard.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"filter"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"length"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"None of the guards passed"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Will succeed if at least one guard in GUARDS is successfully enforced."},"info":null}},"enforce-below-or-at-gas-limit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasLimit","type":"integer","info":null}],"return":"bool"},"defName":"enforce-below-or-at-gas-limit","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.chain-gas-limit.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"Gas Limit must be smaller than or equal to {}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"i","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":null},"info":null}},"enforce-below-or-at-gas-price":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasPrice","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-below-or-at-gas-price","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.chain-gas-price.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"Gas Price must be smaller than or equal to {}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"g","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":null},"info":null}},"guard-any":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"guards","type":{"list":{"guard":null}},"info":null}],"return":{"guard":null}},"defName":"guard-any","defBody":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":{"int":0}},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"length"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Guard list cannot be empty"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.enforce-guard-any.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-user-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Create a guard that succeeds if at least one guard in GUARDS is successfully enforced."},"info":null}},"try-enforce-guard":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"g","type":{"guard":null},"info":null}],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"try-enforce-guard","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":false},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":null},"info":null}},"max-gas-limit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasLimit","type":"integer","info":null}],"return":{"guard":null}},"defName":"max-gas-limit","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.enforce-below-or-at-gas-limit.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-user-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Guard to enforce gas limit is smaller than or equal to GAS LIMIT"},"info":null}},"max-gas-price":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasPrice","type":"decimal","info":null}],"return":{"guard":null}},"defName":"max-gas-price","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.enforce-below-or-at-gas-price.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-user-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Guard to enforce gas price is smaller than or equal to GAS PRICE"},"info":null}},"enforce-below-gas-notional":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasNotional","type":"decimal","info":null}],"return":{"tag":"TypeVar","name":"b","constraint":[]}},"defName":"enforce-below-gas-notional","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.chain-gas-notional.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"Gas Limit * Gas Price must be smaller than {}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"c","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":null},"info":null}},"chain-gas-notional":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"l","constraint":[]}},"defName":"chain-gas-notional","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.chain-gas-price.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.chain-gas-limit.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"*"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Return gas limit * gas price from chain-data"},"info":null}},"enforce-below-gas-price":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasPrice","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-below-gas-price","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.chain-gas-price.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"Gas Price must be smaller than {}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"f","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":null},"info":null}},"enforce-below-gas-limit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasLimit","type":"integer","info":null}],"return":"bool"},"defName":"enforce-below-gas-limit","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.chain-gas-limit.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"Gas Limit must be smaller than {}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"h","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":null},"info":null}},"max-gas-notional":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"gasNotional","type":"decimal","info":null}],"return":{"guard":null}},"defName":"max-gas-notional","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.enforce-below-or-at-gas-notional.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-user-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Guard to enforce gas price * gas limit is smaller than or equal to GAS"},"info":null}},"guard-all":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"guards","type":{"list":{"guard":null}},"info":null}],"return":{"guard":null}},"defName":"guard-all","defBody":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":{"int":0}},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"length"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Guard list cannot be empty"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.guards1.enforce-guard-all.{GmIjTiqsjRic6lm2xafIkQ0Nr-my3iN_AQu5etPvNFY}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-user-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"guards1"},"meta":{"model":[],"docs":"Create a guard that only succeeds if every guard in GUARDS is successfully enforced."},"info":null}}}}

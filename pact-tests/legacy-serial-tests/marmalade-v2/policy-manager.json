{"module":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","blessed":["SpJiV_6CfE3gA5QUlTEKhFgXvZrhg2dORfFqk2GBgjI","mQ_oo2I6T85QydnylhVmoHM9elDsmVD1wV9iXrAuT0I","WC7obfshJ_VsH2PmcTL2iy4TKjbhHvA1WU_aMWIRwKc"],"interfaces":[],"imports":[{"hash":null,"imports":null,"module":{"namespace":"util","name":"fungible-util"},"i":null},{"hash":null,"imports":["token-info"],"module":{"namespace":"kip","name":"token-policy-v2"},"i":null}],"name":{"namespace":"marmalade-v2","name":"policy-manager"},"code":"(module policy-manager GOVERNANCE\n\n  (bless \"mQ_oo2I6T85QydnylhVmoHM9elDsmVD1wV9iXrAuT0I\")\n  (bless \"WC7obfshJ_VsH2PmcTL2iy4TKjbhHvA1WU_aMWIRwKc\")\n  (bless \"SpJiV_6CfE3gA5QUlTEKhFgXvZrhg2dORfFqk2GBgjI\")\n\n  (defconst ADMIN-KS:string \"marmalade-v2.marmalade-contract-admin\")\n\n  (defcap GOVERNANCE ()\n    (enforce-guard ADMIN-KS))\n\n  (use kip.token-policy-v2 [token-info])\n  (use util.fungible-util)\n\n  ; Saves reference to ledger\n  (defschema ledger\n    ledger-impl:module{marmalade-v2.ledger-v2}\n  )\n\n  (deftable ledgers:{ledger}\n    @doc \"Singleton table for ledger reference storage\")\n\n  (defun init:bool(ledger:module{marmalade-v2.ledger-v2})\n    @doc \"Must be initiated with ledger implementation\"\n    (with-capability (GOVERNANCE)\n      (write ledgers \"\" {\n        \"ledger-impl\": ledger\n      })\n    )\n    true\n  )\n\n  (defschema quote-schema\n    @doc \"Quote spec of the sale\"\n    token-id:string\n    amount:decimal\n    seller:string\n    timeout:integer\n    fungible:module{fungible-v2}\n    seller-fungible-account:object{fungible-account}\n    sale-price:decimal\n    sale-type:string\n  )\n\n  (defschema quote-spec\n    fungible:module{fungible-v2}\n    seller-fungible-account:object{fungible-account}\n    sale-price:decimal\n    sale-type:string\n  )\n\n  (defschema fungible-account\n    @doc \"account and guard information of a fungible\"\n    account:string\n    guard:guard\n  )\n\n  (defschema marketplace-fee-spec\n    @doc \"Marketplace fee data to include in payload\"\n    mk-account:string\n    mk-fee-percentage:decimal\n  )\n\n  ;; Saves Sale Logic\n  (defschema sale-contract\n    sale-contract:module{sale-v2}\n  )\n\n  (deftable sale-whitelist:{sale-contract})\n\n  (deftable quotes:{quote-schema})\n\n  (defcap QUOTE:bool\n    ( sale-id:string\n      token-id:string\n      spec:object{quote-spec}\n    )\n    @event\n    true\n  )\n\n  (defconst QUOTE-MSG-KEY:string \"quote\"\n    @doc \"Payload field for quote spec\")\n\n  (defconst BUYER-FUNGIBLE-ACCOUNT-MSG-KEY:string \"buyer_fungible_account\"\n    @doc \"Payload field for buyer's fungible account\")\n\n  (defconst UPDATED-PRICE-KEY:string \"updated_price\"\n    @doc \"Payload field for updated price\")\n\n  (defconst MARKETPLACE-FEE-KEY \"marketplace_fee\"\n    @doc \"Payload field for marketplace fee spec\")\n\n  (defcap ESCROW (sale-id:string)\n    @doc \"Capability to be used as escrow's capability guard\"\n    true\n  )\n\n  ;;\n  ;; policy-manager-v1 caps to be able to validate access to quote-manager & policy operations.\n  ;;\n  (defcap INIT-CALL:bool (id:string precision:integer uri:string policy:string)\n    true\n  )\n\n  (defcap TRANSFER-CALL:bool (id:string sender:string receiver:string amount:decimal policy:string)\n    true\n  )\n\n  (defcap MINT-CALL:bool (id:string account:string amount:decimal policy:string)\n    true\n  )\n\n  (defcap BURN-CALL:bool (id:string account:string amount:decimal policy:string)\n    true\n  )\n\n  (defcap OFFER-CALL:bool (id:string seller:string amount:decimal sale-id:string timeout:integer policy:string)\n    true\n  )\n\n  (defcap WITHDRAW-CALL:bool (id:string seller:string amount:decimal sale-id:string timeout:integer policy:string)\n    true\n  )\n\n  (defcap BUY-CALL:bool (id:string seller:string buyer:string amount:decimal sale-id:string policy:string)\n    true\n  )\n\n  (defcap UPDATE-URI-CALL:bool (id:string new-uri:string policy:string)\n    true\n  )\n\n  (defcap SALE-GUARD-CALL:bool (sale-id:string price:decimal)\n    true\n  )\n\n  (defcap FUNGIBLE-TRANSFER-CALL:bool (id:string)\n    true\n  )\n\n  (defcap UPDATE-QUOTE-PRICE:bool (token-id:string sale-id:string sale-type:string updated-price:decimal)\n    @doc \"Enforces sale-guard on update-quote-price\"\n    (enforce (> updated-price 0.0) \"QUOTE price must be positive\")\n    (compose-capability (SALE-GUARD-CALL sale-id updated-price))\n    (let ((sale-contract:module{sale-v2} (retrieve-sale sale-type)))\n      (sale-contract::enforce-quote-update sale-id updated-price))\n  )\n\n  (defcap SALE-WHITELIST:bool(sale-contract-key:string)\n    @event\n    (enforce-guard ADMIN-KS)\n  )\n\n  (defun get-escrow-account:object{fungible-account} (sale-id:string)\n    @doc \"Returns fungible escrow ACCOUNT and GUARD of the SALE\"\n    { 'account: (create-principal (create-capability-guard (ESCROW sale-id)))\n    , 'guard: (create-capability-guard (ESCROW sale-id))\n    })\n\n  (defun add-sale-whitelist:bool (sale-contract:module{sale-v2})\n    @doc \"Adds quote-guard to quote-guard-whitelist list\"\n    (let ((sale-key (format \"{}\" [sale-contract])))\n      (with-capability (SALE-WHITELIST sale-key)\n        (insert sale-whitelist sale-key\n          { 'sale-contract: sale-contract }\n    )))\n    true\n  )\n\n  ; Saves Concrete policy information\n  (defschema concrete-policy\n    policy:module{kip.token-policy-v2}\n  )\n\n  (deftable concrete-policies:{concrete-policy})\n\n  (defcap CONCRETE-POLICY:bool (policy-field:string policy:module{kip.token-policy-v2})\n    @event\n    (enforce-guard ADMIN-KS))\n\n  (defconst NON_FUNGIBLE_POLICY:string 'non-fungible-policy )\n  (defconst ROYALTY_POLICY:string 'royalty-policy )\n  (defconst COLLECTION_POLICY:string 'collection-policy )\n  (defconst GUARD_POLICY:string 'guard-policy )\n  (defconst CONCRETE_POLICY_LIST:[string]\n    [NON_FUNGIBLE_POLICY ROYALTY_POLICY COLLECTION_POLICY GUARD_POLICY] )\n\n  (defun write-concrete-policy:bool (policy-field:string policy:module{kip.token-policy-v2})\n    (enforce (contains policy-field CONCRETE_POLICY_LIST) \"Not registered as concrete policy\")\n    (with-capability (CONCRETE-POLICY policy-field policy)\n      (write concrete-policies policy-field {\n        \"policy\": policy\n        }\n      )\n    true)\n  )\n\n  ; Capbilities to guard internal functions\n\n  (defcap OFFER:bool (sale-id:string)\n    @doc \"Capability to grant internal transaction inside OFFER\"\n    true\n  )\n\n  (defcap BUY:bool (sale-id:string)\n    @doc \"Capability to grant internal transaction inside BUY\"\n    true\n  )\n\n  (defcap WITHDRAW:bool (sale-id:string)\n    @doc \"Capability to grant internal transaction inside WITHDRAW\"\n    true\n  )\n\n  ; Map list of policy functions\n\n  (defun enforce-init:[bool]\n    (token:object{token-info})\n    (let ((ledger:module{marmalade-v2.ledger-v2} (retrieve-ledger)))\n      (require-capability (ledger::INIT-CALL (at \"id\" token) (at \"precision\" token) (at \"uri\" token)))\n    )\n\n    (map (lambda (policy:module{kip.token-policy-v2})\n      (with-capability (INIT-CALL (at \"id\" token) (at \"precision\" token) (at \"uri\" token) (format \"{}\" [policy]))\n        (policy::enforce-init token)\n      )\n    ) (at 'policies token))\n  )\n\n  (defun enforce-mint:[bool]\n    ( token:object{token-info}\n      account:string\n      guard:guard\n      amount:decimal\n    )\n    (let ((ledger:module{marmalade-v2.ledger-v2} (retrieve-ledger)))\n      (require-capability (ledger::MINT-CALL (at \"id\" token) account amount))\n    )\n    (map (lambda (policy:module{kip.token-policy-v2})\n      (with-capability (MINT-CALL (at \"id\" token) account amount (format \"{}\" [policy]))\n        (policy::enforce-mint token account guard amount)\n      )\n    ) (at 'policies token))\n  )\n\n  (defun enforce-burn:[bool]\n    ( token:object{token-info}\n      account:string\n      amount:decimal\n    )\n    (let ((ledger:module{marmalade-v2.ledger-v2} (retrieve-ledger)))\n      (require-capability (ledger::BURN-CALL (at \"id\" token) account amount))\n    )\n    (map (lambda (policy:module{kip.token-policy-v2})\n      (with-capability (BURN-CALL (at \"id\" token) account amount (format \"{}\" [policy]))\n        (policy::enforce-burn token account amount)\n      )\n    ) (at 'policies token))\n  )\n\n  (defun enforce-offer:[bool]\n    ( token:object{token-info}\n      seller:string\n      amount:decimal\n      timeout:integer\n      sale-id:string )\n    @doc \" Executed at `offer` step of marmalade.ledger.                             \\\n    \\ Required msg-data keys:                                                        \\\n    \\ * (optional) quote:object{quote-spec} - sale is registered as a quoted fungible \\\n    \\ sale if present. If absent, sale proceeds without quotes.\"\n\n    (let ((ledger:module{marmalade-v2.ledger-v2} (retrieve-ledger)))\n      (require-capability (ledger::OFFER-CALL (at \"id\" token) seller amount timeout sale-id))\n    )\n\n    (enforce-sale-pact sale-id)\n    (enforce (= (pact-id) (tx-hash)) \"cannot be triggered as nested defpacts\")\n\n    ; Check if quote-msg exists\n    (if (exists-msg-quote QUOTE-MSG-KEY)\n      ; true - insert quote message and create escrow account in fungible\n    (let* (\n        (quote-spec:object{quote-spec} (read-msg QUOTE-MSG-KEY))\n        (fungible:module{fungible-v2} (at 'fungible quote-spec))\n        (escrow-account:object{fungible-account} (get-escrow-account sale-id))\n        (token-id:string (at 'id token))\n        (quote:object{quote-schema} (+\n            { \"token-id\": token-id\n            , 'seller: seller\n            , 'amount: amount\n            , 'timeout: timeout\n            }\n            quote-spec))\n      )\n      (validate-quote quote)\n      (insert quotes sale-id quote) ;; void sale type\n      (fungible::create-account (at 'account escrow-account) (at 'guard escrow-account))\n      (emit-event (QUOTE sale-id token-id quote-spec))\n    )\n      ; false - skip\n      true\n    )\n     ; run policy::enforce-offer\n    (map\n      (lambda (policy:module{kip.token-policy-v2})\n        (with-capability (OFFER-CALL (at \"id\" token) seller amount sale-id timeout (format \"{}\" [policy]))\n          (policy::enforce-offer token seller amount timeout sale-id)\n        )\n      )\n      (at 'policies token))\n  )\n\n  (defun enforce-withdraw:[bool]\n    ( token:object{token-info}\n      seller:string\n      amount:decimal\n      timeout:integer\n      sale-id:string )\n    @doc \" Executed at `withdraw` step of marmalade.ledger.\"\n    (let ((ledger:module{marmalade-v2.ledger-v2} (retrieve-ledger)))\n      (require-capability (ledger::WITHDRAW-CALL (at \"id\" token) seller amount timeout sale-id))\n    )\n    (enforce-sale-pact sale-id)\n\n    (if (exists-quote sale-id)\n      (let* (\n        (quote-spec:object{quote-schema} (get-quote-info sale-id))\n        (sale-type:string (at 'sale-type quote-spec)))\n\n        (if (!= sale-type \"\")\n          (let ((sale-contract:module{sale-v2} (retrieve-sale sale-type)))\n            (sale-contract::enforce-withdrawal sale-id))\n          true\n        ))\n      true\n    )\n\n    (map (lambda (policy:module{kip.token-policy-v2})\n      (with-capability (WITHDRAW-CALL (at \"id\" token) seller amount sale-id timeout (format \"{}\" [policy]))\n        (policy::enforce-withdraw token seller amount timeout sale-id)\n      )\n    ) (at 'policies token))\n  )\n\n  (defun enforce-buy:[bool]\n    ( token:object{token-info}\n      seller:string\n      buyer:string\n      buyer-guard:guard\n      amount:decimal\n      sale-id:string )\n      @doc \" Executed at `buy` step of marmalade.ledger.                                 \\\n      \\ Required msg-data keys:                                                          \\\n      \\ * (optional) buyer_fungible_account:string - The fungible account of the buyer   \\\n      \\ which transfers the fungible to the escrow account. Only required if the sale is \\\n      \\ a quoted sale. \"\n\n    (enforce-sale-pact sale-id)\n\n    ;; enforce function is called from ledger\n    (let ((ledger:module{marmalade-v2.ledger-v2} (retrieve-ledger)))\n      (require-capability (ledger::BUY-CALL (at \"id\" token) seller buyer amount sale-id))\n    )\n\n    ; Checks if quote is saved at offer\n    (if (exists-quote sale-id)\n\n      ; true - quote is used\n      (let* (\n             (escrow-account:object{fungible-account} (get-escrow-account sale-id))\n             (quote-spec:object{quote-schema} (get-quote-info sale-id))\n             (fungible:module{fungible-v2} (at 'fungible quote-spec))\n             (seller-fungible-account:object{fungible-account} (at 'seller-fungible-account quote-spec))\n             (sale-type:string (at 'sale-type quote-spec))\n             (sale-price:decimal (at 'sale-price quote-spec))\n           )\n\n        ; If a sale contract is being used, update the price accordingly\n        (if (!= sale-type \"\")\n          (if (exists-msg-decimal UPDATED-PRICE-KEY)\n            (let ((updated-price:decimal (read-msg UPDATED-PRICE-KEY)))\n              (fungible::enforce-unit updated-price)\n              (with-capability (UPDATE-QUOTE-PRICE (at 'id token) sale-id sale-type updated-price)\n                (update quotes sale-id { \"sale-price\": updated-price })\n              )\n              true\n            )\n          true\n          )\n          true\n        )\n\n        (let* (\n            (final-sale-price:decimal  (at 'sale-price (get-quote-info sale-id)))\n            (mk-fee-spec:object{marketplace-fee-spec} (try { \"mk-account\": \"\", \"mk-fee-percentage\": 0.0 } (read-msg MARKETPLACE-FEE-KEY)))\n            (mk-fee-percentage:decimal (at 'mk-fee-percentage mk-fee-spec))\n            (mk-fee:decimal (floor (* mk-fee-percentage final-sale-price) (fungible::precision)))\n          )\n          (enforce (> final-sale-price 0.0) \"Price is not finalized for this quote\")\n\n          ; Handle the marketplace fee if applicable\n          (if (= 0.0 mk-fee-percentage)\n            true\n            (with-capability (FUNGIBLE-TRANSFER-CALL sale-id)\n              (enforce (and (>= mk-fee-percentage 0.0) (<= mk-fee-percentage 1.0)) \"Invalid market-fee percentage\")\n\n              (install-capability (fungible::TRANSFER (read-msg BUYER-FUNGIBLE-ACCOUNT-MSG-KEY) (at \"mk-account\" mk-fee-spec) mk-fee))\n              (fungible::transfer (read-msg BUYER-FUNGIBLE-ACCOUNT-MSG-KEY) (at \"mk-account\" mk-fee-spec) mk-fee)\n            )\n          )\n\n          (with-capability (FUNGIBLE-TRANSFER-CALL sale-id)\n            ; Transfer sale amount from buyer to policy manager's escrow account\n            (install-capability (fungible::TRANSFER (read-msg BUYER-FUNGIBLE-ACCOUNT-MSG-KEY) (at 'account escrow-account) final-sale-price))\n            (fungible::transfer-create (read-msg BUYER-FUNGIBLE-ACCOUNT-MSG-KEY) (at 'account escrow-account) (at 'guard escrow-account) final-sale-price)\n          )\n          (with-capability (ESCROW sale-id)\n            ; Run policies::enforce-buy\n            (let ((result:[bool]\n              (map (lambda (policy:module{kip.token-policy-v2})\n                  (with-capability (BUY-CALL (at \"id\" token) seller buyer amount sale-id (format \"{}\" [policy]))\n                    (policy::enforce-buy token seller buyer buyer-guard amount sale-id)\n                  )\n                ) (at 'policies token))\n                ))\n\n              (let (\n                    (balance:decimal (fungible::get-balance (at 'account escrow-account)))\n                  )\n                (install-capability (fungible::TRANSFER (at 'account escrow-account) (at 'account seller-fungible-account) balance))\n                (fungible::transfer (at 'account escrow-account) (at 'account seller-fungible-account) balance)\n              )\n            result\n          ))\n        )\n      )\n\n      ; false: quote is not used\n      (map (lambda (policy:module{kip.token-policy-v2})\n        (with-capability (BUY-CALL (at \"id\" token) seller buyer amount sale-id (format \"{}\" [policy]))\n          (policy::enforce-buy token seller buyer buyer-guard amount sale-id)\n        )\n      ) (at 'policies token))\n    )\n  )\n\n  (defun enforce-transfer:[bool]\n    ( token:object{token-info}\n      sender:string\n      guard:guard\n      receiver:string\n      amount:decimal )\n    (let ((ledger:module{marmalade-v2.ledger-v2} (retrieve-ledger)))\n      (require-capability (ledger::TRANSFER-CALL (at \"id\" token) sender receiver amount))\n    )\n    (map (lambda (policy:module{kip.token-policy-v2})\n      (with-capability (TRANSFER-CALL (at \"id\" token) sender receiver amount (format \"{}\" [policy]))\n        (policy::enforce-transfer token sender guard receiver amount)\n      )\n    ) (at 'policies token))\n  )\n\n  (defun enforce-update-uri:[bool]\n     ( token:object{token-info}\n       new-uri:string )\n     (let ((ledger:module{marmalade-v2.ledger-v2} (retrieve-ledger)))\n       (require-capability (ledger::UPDATE-URI-CALL (at \"id\" token) new-uri))\n     )\n     (map (lambda (policy:module{kip.token-policy-v2,kip.updatable-uri-policy-v1})\n       (with-capability (UPDATE-URI-CALL (at \"id\" token)  new-uri (format \"{}\" [policy]))\n         (policy::enforce-update-uri token new-uri)\n       )\n     ) (at 'policies token))\n   )\n\n  (defun enforce-sale-pact:bool (sale:string)\n    \"Enforces that SALE is id for currently executing pact\"\n    (enforce (= sale (pact-id)) \"Invalid pact/sale id\")\n  )\n\n  ; Utility functions\n\n  (defun exists-quote:bool (sale-id:string)\n    @doc \"Looks up quote table for quote\"\n    (try false (let ((q (get-quote-info sale-id))) true))\n  )\n\n  (defun exists-msg-decimal:bool (msg:string)\n    @doc \"Checks env-data field and see if the msg is a decimal\"\n    (let  ((d:decimal (try -1.0 (read-msg msg))))\n      (!= d -1.0))\n  )\n\n  (defun exists-msg-quote:bool (msg:string)\n    @doc \"Checks env-data field and see if the msg is a object\"\n    (let ((o:object (try {} (read-msg msg))))\n      (!= o {}))\n  )\n\n  (defun retrieve-ledger:module{marmalade-v2.ledger-v2} ()\n    @doc \"Retrieves the ledger implementation\"\n    (with-read ledgers \"\" {\n        \"ledger-impl\":= ledger\n      }\n    ledger)\n  )\n\n  (defun retrieve-sale:module{sale-v2} (sale-type:string)\n    @doc \"Retrieves the sale-contract\"\n    (with-read sale-whitelist sale-type {\"sale-contract\":= sale} sale)\n  )\n\n  (defun get-concrete-policy:module{kip.token-policy-v2} (policy-field:string)\n    (with-read concrete-policies policy-field {\n      \"policy\":= policy\n      }\n      policy)\n  )\n\n  (defun get-quote-info:object{quote-schema} (sale-id:string)\n    @doc \"Get Quote information\"\n    (read quotes sale-id)\n  )\n\n  ;; Validate functions\n  (defun validate-fungible-account (fungible:module{fungible-v2} account:object{fungible-account})\n    (let ((seller-details (fungible::details (at 'account account))))\n      (enforce (=\n        (at 'guard seller-details) (at 'guard account))\n            \"Account guard does not match\"))\n  )\n\n  (defun validate-quote:bool (quote-spec:object{quote-schema})\n    (let* ( (fungible:module{fungible-v2} (at 'fungible quote-spec) )\n            (seller-fungible-account:object{fungible-account} (at 'seller-fungible-account quote-spec))\n            (sale-type:string (at 'sale-type quote-spec))\n            (sale-price:decimal (at 'sale-price quote-spec)) )\n      (validate-fungible-account fungible seller-fungible-account)\n      (fungible::enforce-unit sale-price)\n      (if (= sale-type \"\")\n        (enforce (> sale-price 0.0) \"Offer price must be positive\" )\n        [ (retrieve-sale sale-type)\n          (enforce (>= sale-price 0.0) \"Offer price must be positive or zero\")\n        ]\n      )\n      true)\n  )\n)\n\n","meta":{"model":[],"docs":null},"governance":{"capability":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"GOVERNANCE","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}},"refMap":{"QUOTE-MSG-KEY":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"QUOTE-MSG-KEY","type":"string","info":null},"meta":{"model":[],"docs":"Payload field for quote spec"},"val":{"raw":{"i":null,"lit":"quote"},"eval":{"var":{"direct":{"pdval":"quote"}},"i":null}},"i":null}},"concrete-policies":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policies","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policy","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"TRANSFER-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"TRANSFER-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"exists-quote":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"exists-quote","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":false},{"body":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"pairs":[{"arg":{"name":"q","type":{"tag":"TypeVar","name":"ah","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Looks up quote table for quote"},"info":null}},"OFFER-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"OFFER-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"ESCROW":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":{"tag":"TypeVar","name":"c","constraint":[]}},"defName":"ESCROW","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Capability to be used as escrow's capability guard"},"info":null}},"NON_FUNGIBLE_POLICY":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"NON_FUNGIBLE_POLICY","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"non-fungible-policy"},"eval":{"var":{"direct":{"pdval":"non-fungible-policy"}},"i":null}},"i":null}},"get-quote-info":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"partial":"full"}},"defName":"get-quote-info","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quotes","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Get Quote information"},"info":null}},"write-concrete-policy":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"policy-field","type":"string","info":null},{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}],"return":"bool"},"defName":"write-concrete-policy","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":["non-fungible-policy","royalty-policy","collection-policy","guard-policy"]}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"contains"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Not registered as concrete policy"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.CONCRETE-POLICY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policies","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policy","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"policy":{"var":{"b":1},"i":null}},"keyorder":["policy"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"write"}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"init":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"ledger","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}],"return":"bool"},"defName":"init","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.GOVERNANCE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledgers","meta":{"model":[],"docs":"Singleton table for ledger reference storage"},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledger","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"ledger-impl","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"i":null,"lit":""},{"obj":{"ledger-impl":{"var":{"b":0},"i":null}},"keyorder":["ledger-impl"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"write"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Must be initiated with ledger implementation"},"info":null}},"quote-spec":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-spec","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"INIT-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"INIT-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"enforce-mint":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null}],"return":{"list":"bool"}},"defName":"enforce-mint","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"MINT-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-mint"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af9","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"l","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.MINT-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-mint","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Minting policy for TOKEN to ACCOUNT for AMOUNT."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"k","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"OFFER":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"OFFER","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Capability to grant internal transaction inside OFFER"},"info":null}},"enforce-burn":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"list":"bool"}},"defName":"enforce-burn","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"BURN-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-burn"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af12","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"o","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.BURN-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-burn","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Burning policy for TOKEN to ACCOUNT for AMOUNT."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"n","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"get-escrow-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"}},"defName":"get-escrow-account","defBody":{"scope":{"list":[{"obj":{"guard":{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.ESCROW.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-capability-guard"}},"i":null}},"i":null},"info":null},"account":{"args":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.ESCROW.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-capability-guard"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-principal"}},"i":null}},"i":null},"info":null}},"keyorder":["account","guard"],"type":"*","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Returns fungible escrow ACCOUNT and GUARD of the SALE"},"info":null}},"sale-whitelist":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-whitelist","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-contract","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"SALE-WHITELIST":{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"sale-contract-key","type":"string","info":null}],"return":"bool"},"defName":"SALE-WHITELIST","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"enforce-sale-pact":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale","type":"string","info":null}],"return":"bool"},"defName":"enforce-sale-pact","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Invalid pact/sale id"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Enforces that SALE is id for currently executing pact"},"info":null}},"UPDATE-QUOTE-PRICE":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"token-id","type":"string","info":null},{"name":"sale-id","type":"string","info":null},{"name":"sale-type","type":"string","info":null},{"name":"updated-price","type":"decimal","info":null}],"return":"bool"},"defName":"UPDATE-QUOTE-PRICE","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":3},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"QUOTE price must be positive"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":1},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.SALE-GUARD-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null},{"name":"price","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-quote-update","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"sale-v2"},"meta":{"model":[],"docs":"Read-only Function that is enforced to update quote price at enforce-buy"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-contract","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-sale.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Enforces sale-guard on update-quote-price"},"info":null}},"retrieve-ledger":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]}},"defName":"retrieve-ledger","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledgers","meta":{"model":[],"docs":"Singleton table for ledger reference storage"},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledger","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"ledger-impl","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"i":null,"lit":""},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"tag":"TypeVar","name":"ai","constraint":[]},"info":null},"val":{"i":null,"lit":"ledger-impl"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Retrieves the ledger implementation"},"info":null}},"ledgers":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledgers","meta":{"model":[],"docs":"Singleton table for ledger reference storage"},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledger","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"ledger-impl","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"quote-schema":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"BUY-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"BUY-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"MINT-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"MINT-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"validate-quote":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"quote-spec","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"partial":"full"},"info":null}],"return":"bool"},"defName":"validate-quote","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.validate-fungible-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"amount","type":"decimal","info":{"d":[6,3603,3603],"c":"amount"}}],"return":"bool"},"defName":"enforce-unit","defBody":{"scope":{"list":[],"type":"*","i":{"d":[120,3571,3571],"c":"(defun enforce-unit:bool\n     ( amount:decimal )\n     \" Enforce minimum precision allowed for transactions.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Enforce minimum precision allowed for transactions."},"info":{"d":[120,3571,3571],"c":"(defun enforce-unit:bool\n     ( amount:decimal )\n     \" Enforce minimum precision allowed for transactions.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Offer price must be positive"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-sale.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Offer price must be positive or zero"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":{"tag":"TypeVar","name":"an","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-price","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":"sale-price"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-type","type":"string","info":null},"val":{"args":[{"i":null,"lit":"sale-type"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"i":null,"lit":"seller-fungible-account"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"fungible","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"i":null,"lit":"fungible"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"enforce-init":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null}],"return":{"list":"bool"}},"defName":"enforce-init","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"precision"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"uri"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null}],"return":"bool"},"defName":"INIT-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-init "},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af6","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"precision"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"uri"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"i","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.INIT-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null}],"return":"bool"},"defName":"enforce-init","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Enforce policy on TOKEN initiation."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"h","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"quotes":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quotes","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"i":null}},"BURN-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"BURN-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"SALE-GUARD-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null},{"name":"price","type":"decimal","info":null}],"return":"bool"},"defName":"SALE-GUARD-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"sale-contract":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-contract","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}]}},"marketplace-fee-spec":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"marketplace-fee-spec","meta":{"model":[],"docs":"Marketplace fee data to include in payload"},"i":null,"fields":[{"name":"mk-account","type":"string","info":null},{"name":"mk-fee-percentage","type":"decimal","info":null}]}},"fungible-account":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"add-sale-whitelist":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}],"return":"bool"},"defName":"add-sale-whitelist","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.SALE-WHITELIST.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-whitelist","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-contract","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"sale-contract":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"keyorder":["sale-contract"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-key","type":{"tag":"TypeVar","name":"d","constraint":[]},"info":null},"val":{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"e","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Adds quote-guard to quote-guard-whitelist list"},"info":null}},"validate-fungible-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null}],"return":{"tag":"TypeVar","name":"al","constraint":[]}},"defName":"validate-fungible-account","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"guard"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"guard"},{"var":{"f":{"var":{"b":1},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Account guard does not match"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"seller-details","type":{"tag":"TypeVar","name":"am","constraint":[]},"info":null},"val":{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":{"d":[7,3356,3356],"c":"account"}}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":null,"name":"fungible-v2"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":{"d":[10,283,283],"c":"invariant "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,294,294],"c":"!= "}},{"i":{"d":[3,297,297],"c":"\"\" "},"lit":""},{"atom":"sender","q":[],"i":{"d":[6,300,300],"c":"sender"}}],"d":"()","i":{"d":[14,293,293],"c":"(!= \"\" sender)"}}],"d":"()","i":{"d":[27,282,282],"c":"(invariant (!= \"\" sender)) "}}],"docs":"Schema for results of 'account' operation."},"i":{"d":[272,188,188],"c":"(defschema account-details\n    @doc \"Schema for results of 'account' operation.\"\n    @model [ (invariant (!= \"\" sender)) ]\n\n    account:string\n    balance:decimal\n    guard:guard)\n\n\n   ; ----------------------------------------------------------------------\n   ; Caps\n\n   "},"fields":[{"name":"account","type":"string","info":{"d":[7,316,316],"c":"account"}},{"name":"balance","type":"decimal","info":{"d":[7,335,335],"c":"balance"}},{"name":"guard","type":{"guard":null},"info":{"d":[5,355,355],"c":"guard"}}]}},"i":{"d":[15,3332,3332],"c":"account-details"}},"partial":"full"}},"defName":"details","defBody":{"scope":{"list":[],"type":"*","i":{"d":[164,3310,3310],"c":"(defun details:object{account-details}\n     ( account: string )\n     \" Get an object with details of ACCOUNT. \\\n     \\ Fails if account does not exist.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Get an object with details of ACCOUNT.  Fails if account does not exist."},"info":{"d":[164,3310,3310],"c":"(defun details:object{account-details}\n     ( account: string )\n     \" Get an object with details of ACCOUNT. \\\n     \\ Fails if account does not exist.\"\n     )\n\n   "}}},"i":null}},"i":null}},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"UPDATED-PRICE-KEY":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"UPDATED-PRICE-KEY","type":"string","info":null},"meta":{"model":[],"docs":"Payload field for updated price"},"val":{"raw":{"i":null,"lit":"updated_price"},"eval":{"var":{"direct":{"pdval":"updated_price"}},"i":null}},"i":null}},"concrete-policy":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policy","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}]}},"QUOTE":{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"sale-id","type":"string","info":null},{"name":"token-id","type":"string","info":null},{"name":"spec","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-spec","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"partial":"full"},"info":null}],"return":"bool"},"defName":"QUOTE","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"WITHDRAW":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"WITHDRAW","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Capability to grant internal transaction inside WITHDRAW"},"info":null}},"CONCRETE-POLICY":{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"policy-field","type":"string","info":null},{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}],"return":"bool"},"defName":"CONCRETE-POLICY","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"GUARD_POLICY":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"GUARD_POLICY","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"guard-policy"},"eval":{"var":{"direct":{"pdval":"guard-policy"}},"i":null}},"i":null}},"ADMIN-KS":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"ADMIN-KS","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"marmalade-v2.marmalade-contract-admin"},"eval":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"exists-msg-decimal":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"msg","type":"string","info":null}],"return":"bool"},"defName":"exists-msg-decimal","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":-1}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"d","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":-1},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Checks env-data field and see if the msg is a decimal"},"info":null}},"ledger":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledger","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"ledger-impl","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}]}},"WITHDRAW-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"WITHDRAW-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"CONCRETE_POLICY_LIST":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"CONCRETE_POLICY_LIST","type":{"list":"string"},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"list":[{"var":{"ref":{"var":{"direct":{"pdval":"non-fungible-policy"}},"i":null}},"i":null},{"var":{"ref":{"var":{"direct":{"pdval":"royalty-policy"}},"i":null}},"i":null},{"var":{"ref":{"var":{"direct":{"pdval":"collection-policy"}},"i":null}},"i":null},{"var":{"ref":{"var":{"direct":{"pdval":"guard-policy"}},"i":null}},"i":null}],"type":{"tag":"TypeVar","name":"f","constraint":[]},"i":null},"eval":{"var":{"direct":{"pdval":["non-fungible-policy","royalty-policy","collection-policy","guard-policy"]}},"i":null}},"i":null}},"UPDATE-URI-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"new-uri","type":"string","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"UPDATE-URI-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"enforce-buy":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"buyer-guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":{"list":"bool"}},"defName":"enforce-buy","defBody":{"scope":{"list":[{"args":[{"var":{"b":5},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-sale-pact.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":5},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"BUY-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-buy"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"args":[{"var":{"b":5},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.exists-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"updated_price"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.exists-msg-decimal.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"amount","type":"decimal","info":{"d":[6,3603,3603],"c":"amount"}}],"return":"bool"},"defName":"enforce-unit","defBody":{"scope":{"list":[],"type":"*","i":{"d":[120,3571,3571],"c":"(defun enforce-unit:bool\n     ( amount:decimal )\n     \" Enforce minimum precision allowed for transactions.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Enforce minimum precision allowed for transactions."},"info":{"d":[120,3571,3571],"c":"(defun enforce-unit:bool\n     ( amount:decimal )\n     \" Enforce minimum precision allowed for transactions.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null},{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.UPDATE-QUOTE-PRICE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quotes","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"obj":{"sale-price":{"var":{"b":0},"i":null}},"keyorder":["sale-price"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"pairs":[{"arg":{"name":"updated-price","type":"decimal","info":null},"val":{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"updated_price"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Price is not finalized for this quote"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":0},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.FUNGIBLE-TRANSFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"i":null,"lit":1}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"and"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Invalid market-fee percentage"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"mk-account"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"managed","type":"decimal","info":{"d":[7,780,780],"c":"managed"}},{"name":"requested","type":"decimal","info":{"d":[9,803,803],"c":"requested"}}],"return":"decimal"},"defName":"TRANSFER-mgr","defBody":{"scope":{"list":[],"type":"*","i":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Manages TRANSFER AMOUNT linearly,  such that a request for 1.0 amount on a 3.0  managed quantity emits updated amount 2.0."},"info":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"i":{"d":[18,721,721],"c":"TRANSFER-mgr\n     "}}},"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,489,489],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,510,510],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,533,533],"c":"amount"}}],"return":"bool"},"defName":"TRANSFER","defBody":{"scope":{"list":[],"type":"*","i":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Managed capability sealing AMOUNT for transfer from SENDER to  RECEIVER. Permits any number of transfers up to AMOUNT."},"info":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"install-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"mk-account"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,1126,1126],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,1146,1146],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,1168,1168],"c":"amount"}}],"return":"string"},"defName":"transfer","defBody":{"scope":{"list":[],"type":"*","i":{"d":[409,1097,1097],"c":"(defun transfer:string\n    ( sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n         \\ Fails if either SENDER or RECEIVER does not exist.\"\n    @model [ (property (> amount 0.0))\n             (property (!= sender \"\"))\n             (property (!= receiver \"\"))\n             (property (!= sender receiver))\n           ]\n    )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":{"d":[9,1333,1333],"c":"property "}},{"list":[{"atom":">","q":[],"i":{"d":[2,1343,1343],"c":"> "}},{"atom":"amount","q":[],"i":{"d":[7,1345,1345],"c":"amount "}},{"i":{"d":[3,1352,1352],"c":"0.0"},"lit":0}],"d":"()","i":{"d":[14,1342,1342],"c":"(> amount 0.0)"}}],"d":"()","i":{"d":[39,1332,1332],"c":"(property (> amount 0.0))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1372,1372],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1382,1382],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,1385,1385],"c":"sender "}},{"i":{"d":[2,1392,1392],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[14,1381,1381],"c":"(!= sender \"\")"}}],"d":"()","i":{"d":[39,1371,1371],"c":"(property (!= sender \"\"))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1411,1411],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1421,1421],"c":"!= "}},{"atom":"receiver","q":[],"i":{"d":[9,1424,1424],"c":"receiver "}},{"i":{"d":[2,1433,1433],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[16,1420,1420],"c":"(!= receiver \"\")"}}],"d":"()","i":{"d":[41,1410,1410],"c":"(property (!= receiver \"\"))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1452,1452],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1462,1462],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,1465,1465],"c":"sender "}},{"atom":"receiver","q":[],"i":{"d":[8,1472,1472],"c":"receiver"}}],"d":"()","i":{"d":[20,1461,1461],"c":"(!= sender receiver)"}}],"d":"()","i":{"d":[43,1451,1451],"c":"(property (!= sender receiver))\n           "}}],"docs":" Transfer AMOUNT between accounts SENDER and RECEIVER.  Fails if either SENDER or RECEIVER does not exist."},"info":{"d":[409,1097,1097],"c":"(defun transfer:string\n    ( sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n         \\ Fails if either SENDER or RECEIVER does not exist.\"\n    @model [ (property (> amount 0.0))\n             (property (!= sender \"\"))\n             (property (!= receiver \"\"))\n             (property (!= sender receiver))\n           ]\n    )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.FUNGIBLE-TRANSFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"managed","type":"decimal","info":{"d":[7,780,780],"c":"managed"}},{"name":"requested","type":"decimal","info":{"d":[9,803,803],"c":"requested"}}],"return":"decimal"},"defName":"TRANSFER-mgr","defBody":{"scope":{"list":[],"type":"*","i":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Manages TRANSFER AMOUNT linearly,  such that a request for 1.0 amount on a 3.0  managed quantity emits updated amount 2.0."},"info":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"i":{"d":[18,721,721],"c":"TRANSFER-mgr\n     "}}},"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,489,489],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,510,510],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,533,533],"c":"amount"}}],"return":"bool"},"defName":"TRANSFER","defBody":{"scope":{"list":[],"type":"*","i":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Managed capability sealing AMOUNT for transfer from SENDER to  RECEIVER. Permits any number of transfers up to AMOUNT."},"info":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"install-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"guard"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,1543,1543],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,1564,1564],"c":"receiver"}},{"name":"receiver-guard","type":{"guard":null},"info":{"d":[14,1587,1587],"c":"receiver-guard"}},{"name":"amount","type":"decimal","info":{"d":[6,1615,1615],"c":"amount"}}],"return":"string"},"defName":"transfer-create","defBody":{"scope":{"list":[],"type":"*","i":{"d":[656,1506,1506],"c":"(defun transfer-create:string\n     ( sender:string\n       receiver:string\n       receiver-guard:guard\n       amount:decimal\n     )\n     @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n          \\ Fails if SENDER does not exist. If RECEIVER exists, guard \\\n          \\ must match existing value. If RECEIVER does not exist, \\\n          \\ RECEIVER account is created using RECEIVER-GUARD. \\\n          \\ Subject to management by TRANSFER capability.\"\n     @model [ (property (> amount 0.0))\n              (property (!= sender \"\"))\n              (property (!= receiver \"\"))\n              (property (!= sender receiver))\n            ]\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":{"d":[9,1984,1984],"c":"property "}},{"list":[{"atom":">","q":[],"i":{"d":[2,1994,1994],"c":"> "}},{"atom":"amount","q":[],"i":{"d":[7,1996,1996],"c":"amount "}},{"i":{"d":[3,2003,2003],"c":"0.0"},"lit":0}],"d":"()","i":{"d":[14,1993,1993],"c":"(> amount 0.0)"}}],"d":"()","i":{"d":[40,1983,1983],"c":"(property (> amount 0.0))\n              "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,2024,2024],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,2034,2034],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,2037,2037],"c":"sender "}},{"i":{"d":[2,2044,2044],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[14,2033,2033],"c":"(!= sender \"\")"}}],"d":"()","i":{"d":[40,2023,2023],"c":"(property (!= sender \"\"))\n              "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,2064,2064],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,2074,2074],"c":"!= "}},{"atom":"receiver","q":[],"i":{"d":[9,2077,2077],"c":"receiver "}},{"i":{"d":[2,2086,2086],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[16,2073,2073],"c":"(!= receiver \"\")"}}],"d":"()","i":{"d":[42,2063,2063],"c":"(property (!= receiver \"\"))\n              "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,2106,2106],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,2116,2116],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,2119,2119],"c":"sender "}},{"atom":"receiver","q":[],"i":{"d":[8,2126,2126],"c":"receiver"}}],"d":"()","i":{"d":[20,2115,2115],"c":"(!= sender receiver)"}}],"d":"()","i":{"d":[44,2105,2105],"c":"(property (!= sender receiver))\n            "}}],"docs":" Transfer AMOUNT between accounts SENDER and RECEIVER.  Fails if SENDER does not exist. If RECEIVER exists, guard  must match existing value. If RECEIVER does not exist,  RECEIVER account is created using RECEIVER-GUARD.  Subject to management by TRANSFER capability."},"info":{"d":[656,1506,1506],"c":"(defun transfer-create:string\n     ( sender:string\n       receiver:string\n       receiver-guard:guard\n       amount:decimal\n     )\n     @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n          \\ Fails if SENDER does not exist. If RECEIVER exists, guard \\\n          \\ must match existing value. If RECEIVER does not exist, \\\n          \\ RECEIVER account is created using RECEIVER-GUARD. \\\n          \\ Subject to management by TRANSFER capability.\"\n     @model [ (property (> amount 0.0))\n              (property (!= sender \"\"))\n              (property (!= receiver \"\"))\n              (property (!= sender receiver))\n            ]\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.ESCROW.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"managed","type":"decimal","info":{"d":[7,780,780],"c":"managed"}},{"name":"requested","type":"decimal","info":{"d":[9,803,803],"c":"requested"}}],"return":"decimal"},"defName":"TRANSFER-mgr","defBody":{"scope":{"list":[],"type":"*","i":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Manages TRANSFER AMOUNT linearly,  such that a request for 1.0 amount on a 3.0  managed quantity emits updated amount 2.0."},"info":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"i":{"d":[18,721,721],"c":"TRANSFER-mgr\n     "}}},"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,489,489],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,510,510],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,533,533],"c":"amount"}}],"return":"bool"},"defName":"TRANSFER","defBody":{"scope":{"list":[],"type":"*","i":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Managed capability sealing AMOUNT for transfer from SENDER to  RECEIVER. Permits any number of transfers up to AMOUNT."},"info":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"install-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,1126,1126],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,1146,1146],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,1168,1168],"c":"amount"}}],"return":"string"},"defName":"transfer","defBody":{"scope":{"list":[],"type":"*","i":{"d":[409,1097,1097],"c":"(defun transfer:string\n    ( sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n         \\ Fails if either SENDER or RECEIVER does not exist.\"\n    @model [ (property (> amount 0.0))\n             (property (!= sender \"\"))\n             (property (!= receiver \"\"))\n             (property (!= sender receiver))\n           ]\n    )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":{"d":[9,1333,1333],"c":"property "}},{"list":[{"atom":">","q":[],"i":{"d":[2,1343,1343],"c":"> "}},{"atom":"amount","q":[],"i":{"d":[7,1345,1345],"c":"amount "}},{"i":{"d":[3,1352,1352],"c":"0.0"},"lit":0}],"d":"()","i":{"d":[14,1342,1342],"c":"(> amount 0.0)"}}],"d":"()","i":{"d":[39,1332,1332],"c":"(property (> amount 0.0))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1372,1372],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1382,1382],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,1385,1385],"c":"sender "}},{"i":{"d":[2,1392,1392],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[14,1381,1381],"c":"(!= sender \"\")"}}],"d":"()","i":{"d":[39,1371,1371],"c":"(property (!= sender \"\"))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1411,1411],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1421,1421],"c":"!= "}},{"atom":"receiver","q":[],"i":{"d":[9,1424,1424],"c":"receiver "}},{"i":{"d":[2,1433,1433],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[16,1420,1420],"c":"(!= receiver \"\")"}}],"d":"()","i":{"d":[41,1410,1410],"c":"(property (!= receiver \"\"))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1452,1452],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1462,1462],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,1465,1465],"c":"sender "}},{"atom":"receiver","q":[],"i":{"d":[8,1472,1472],"c":"receiver"}}],"d":"()","i":{"d":[20,1461,1461],"c":"(!= sender receiver)"}}],"d":"()","i":{"d":[43,1451,1451],"c":"(property (!= sender receiver))\n           "}}],"docs":" Transfer AMOUNT between accounts SENDER and RECEIVER.  Fails if either SENDER or RECEIVER does not exist."},"info":{"d":[409,1097,1097],"c":"(defun transfer:string\n    ( sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n         \\ Fails if either SENDER or RECEIVER does not exist.\"\n    @model [ (property (> amount 0.0))\n             (property (!= sender \"\"))\n             (property (!= receiver \"\"))\n             (property (!= sender receiver))\n           ]\n    )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"balance","type":"decimal","info":null},"val":{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":{"d":[7,3216,3216],"c":"account"}}],"return":"decimal"},"defName":"get-balance","defBody":{"scope":{"list":[],"type":"*","i":{"d":[128,3182,3182],"c":"(defun get-balance:decimal\n     ( account:string )\n     \" Get balance for ACCOUNT. Fails if account does not exist.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Get balance for ACCOUNT. Fails if account does not exist."},"info":{"d":[128,3182,3182],"c":"(defun get-balance:decimal\n     ( account:string )\n     \" Get balance for ACCOUNT. Fails if account does not exist.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}}],"type":"let","i":null},{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"result","type":{"list":"bool"},"info":null},"val":{"args":[{"amArg":"`af21","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"x","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.BUY-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":3},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"buyer-guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-buy","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Buy policy on SALE-ID by SELLER to BUYER AMOUNT of TOKEN."},"info":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"w","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"mk-fee","type":"decimal","info":null},"val":{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"*"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":"integer"},"defName":"precision","defBody":{"scope":{"list":[],"type":"*","i":{"d":[97,3474,3474],"c":"(defun precision:integer\n     ()\n     \"Return the maximum allowed decimal precision.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":"Return the maximum allowed decimal precision."},"info":{"d":[97,3474,3474],"c":"(defun precision:integer\n     ()\n     \"Return the maximum allowed decimal precision.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"floor"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"mk-fee-percentage","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":"mk-fee-percentage"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"mk-fee-spec","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"marketplace-fee-spec","meta":{"model":[],"docs":"Marketplace fee data to include in payload"},"i":null,"fields":[{"name":"mk-account","type":"string","info":null},{"name":"mk-fee-percentage","type":"decimal","info":null}]}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"obj":{"mk-account":{"i":null,"lit":""},"mk-fee-percentage":{"i":null,"lit":0}},"keyorder":["mk-account","mk-fee-percentage"],"type":"*","i":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marketplace_fee"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"final-sale-price","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":"sale-price"},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-price","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":"sale-price"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-type","type":"string","info":null},"val":{"args":[{"i":null,"lit":"sale-type"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"i":null,"lit":"seller-fungible-account"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"fungible","type":{"modspec":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}},"i":null}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"i":null,"lit":"fungible"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"quote-spec","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"f":{"var":{"b":5},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"escrow-account","type":{"schema":"object","type":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"b":5},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-escrow-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af24","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":5},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"aa","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.BUY-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":5},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"buyer-guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-buy","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Buy policy on SALE-ID by SELLER to BUYER AMOUNT of TOKEN."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"z","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":" Executed at `buy` step of marmalade.ledger.                                  Required msg-data keys:                                                           * (optional) buyer_fungible_account:string - The fungible account of the buyer    which transfers the fungible to the escrow account. Only required if the sale is  a quoted sale. "},"info":null}},"enforce-transfer":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sender","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"list":"bool"}},"defName":"enforce-transfer","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"TRANSFER-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-transfer"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af27","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"ad","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.TRANSFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sender","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-transfer","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":" Enforce rules on transfer of TOKEN AMOUNT from SENDER to RECEIVER.  Also governs rotate of SENDER (with same RECEIVER and 0.0 AMOUNT). "},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"ac","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"retrieve-sale":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-type","type":"string","info":null}],"return":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]}},"defName":"retrieve-sale","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-whitelist","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-contract","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale","type":{"tag":"TypeVar","name":"aj","constraint":[]},"info":null},"val":{"i":null,"lit":"sale-contract"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Retrieves the sale-contract"},"info":null}},"enforce-offer":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":{"list":"bool"}},"defName":"enforce-offer","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"OFFER-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-offer"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-sale-pact.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"tx-hash"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"i":null,"lit":"cannot be triggered as nested defpacts"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"quote"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.exists-msg-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.validate-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quotes","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"guard"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":{"d":[7,3727,3727],"c":"account"}},{"name":"guard","type":{"guard":null},"info":{"d":[5,3749,3749],"c":"guard"}}],"return":"string"},"defName":"create-account","defBody":{"scope":{"list":[],"type":"*","i":{"d":[160,3691,3691],"c":"(defun create-account:string\n     ( account:string\n       guard:guard\n     )\n     \" Create ACCOUNT with 0.0 balance, with GUARD controlling access.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Create ACCOUNT with 0.0 balance, with GUARD controlling access."},"info":{"d":[160,3691,3691],"c":"(defun create-account:string\n     ( account:string\n       guard:guard\n     )\n     \" Create ACCOUNT with 0.0 balance, with GUARD controlling access.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.QUOTE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"quote","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"obj":{"amount":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"token-id":{"var":{"b":0},"i":null},"seller":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"timeout":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":3},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"keyorder":["token-id","seller","amount","timeout"],"type":"*","i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"token-id","type":"string","info":null},"val":{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"escrow-account","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-escrow-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"fungible","type":{"modspec":[{"var":{"f":{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"i":null,"lit":"fungible"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"quote-spec","type":{"schema":"object","type":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-spec","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"quote"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null},{"args":[{"amArg":"`af15","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"r","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.OFFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-offer","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Offer policy of sale SALE-ID by SELLER of AMOUNT of TOKEN."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"q","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":" Executed at `offer` step of marmalade.ledger.                              Required msg-data keys:                                                         * (optional) quote:object{quote-spec} - sale is registered as a quoted fungible  sale if present. If absent, sale proceeds without quotes."},"info":null}},"ROYALTY_POLICY":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"ROYALTY_POLICY","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"royalty-policy"},"eval":{"var":{"direct":{"pdval":"royalty-policy"}},"i":null}},"i":null}},"exists-msg-quote":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"msg","type":"string","info":null}],"return":"bool"},"defName":"exists-msg-quote","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null},{"obj":{},"keyorder":[],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"o","type":{"schema":"object","type":"*","partial":"full"},"info":null},"val":{"args":[{"obj":{},"keyorder":[],"type":"*","i":null},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Checks env-data field and see if the msg is a object"},"info":null}},"BUYER-FUNGIBLE-ACCOUNT-MSG-KEY":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"BUYER-FUNGIBLE-ACCOUNT-MSG-KEY","type":"string","info":null},"meta":{"model":[],"docs":"Payload field for buyer's fungible account"},"val":{"raw":{"i":null,"lit":"buyer_fungible_account"},"eval":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"MARKETPLACE-FEE-KEY":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"MARKETPLACE-FEE-KEY","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":null},"meta":{"model":[],"docs":"Payload field for marketplace fee spec"},"val":{"raw":{"i":null,"lit":"marketplace_fee"},"eval":{"var":{"direct":{"pdval":"marketplace_fee"}},"i":null}},"i":null}},"BUY":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"BUY","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Capability to grant internal transaction inside BUY"},"info":null}},"GOVERNANCE":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"GOVERNANCE","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"COLLECTION_POLICY":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"COLLECTION_POLICY","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"collection-policy"},"eval":{"var":{"direct":{"pdval":"collection-policy"}},"i":null}},"i":null}},"FUNGIBLE-TRANSFER-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null}],"return":"bool"},"defName":"FUNGIBLE-TRANSFER-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"enforce-withdraw":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":{"list":"bool"}},"defName":"enforce-withdraw","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"WITHDRAW-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-withdraw"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-sale-pact.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.exists-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-withdrawal","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"sale-v2"},"meta":{"model":[],"docs":"Read-only Function that is enforced to allow withdrawal from sale"},"info":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-contract","type":{"modspec":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}},"i":null}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-sale.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-type","type":"string","info":null},"val":{"args":[{"i":null,"lit":"sale-type"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"quote-spec","type":{"schema":"object","type":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null},{"args":[{"amArg":"`af18","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"u","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.WITHDRAW-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-withdraw","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Withdraw policy on SALE-ID by SELLER of AMOUNT of TOKEN"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"t","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":" Executed at `withdraw` step of marmalade.ledger."},"info":null}},"get-concrete-policy":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"policy-field","type":"string","info":null}],"return":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"defName":"get-concrete-policy","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policies","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policy","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"policy","type":{"tag":"TypeVar","name":"ak","constraint":[]},"info":null},"val":{"i":null,"lit":"policy"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}},"enforce-update-uri":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"new-uri","type":"string","info":null}],"return":{"list":"bool"}},"defName":"enforce-update-uri","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"new-uri","type":"string","info":null}],"return":"bool"},"defName":"UPDATE-URI-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-update-uri"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af30","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"ag","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.UPDATE-URI-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"new-uri","type":"string","info":null}],"return":"bool"},"defName":"enforce-update-uri","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"updatable-uri-policy-v1"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"new-uri","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Updating the URI of a token."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null},{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"updatable-uri-policy-v1"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"af","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}}}

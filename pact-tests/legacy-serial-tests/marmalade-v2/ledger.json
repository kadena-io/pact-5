{"dependencies":[["marmalade-v2.policy-manager.enforce-offer.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":{"list":"bool"}},"defName":"enforce-offer","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"OFFER-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-offer"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-sale-pact.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"tx-hash"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"i":null,"lit":"cannot be triggered as nested defpacts"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"quote"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.exists-msg-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.validate-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quotes","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"guard"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":{"d":[7,3727,3727],"c":"account"}},{"name":"guard","type":{"guard":null},"info":{"d":[5,3749,3749],"c":"guard"}}],"return":"string"},"defName":"create-account","defBody":{"scope":{"list":[],"type":"*","i":{"d":[160,3691,3691],"c":"(defun create-account:string\n     ( account:string\n       guard:guard\n     )\n     \" Create ACCOUNT with 0.0 balance, with GUARD controlling access.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Create ACCOUNT with 0.0 balance, with GUARD controlling access."},"info":{"d":[160,3691,3691],"c":"(defun create-account:string\n     ( account:string\n       guard:guard\n     )\n     \" Create ACCOUNT with 0.0 balance, with GUARD controlling access.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.QUOTE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"quote","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"obj":{"amount":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"token-id":{"var":{"b":0},"i":null},"seller":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"timeout":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":3},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"keyorder":["token-id","seller","amount","timeout"],"type":"*","i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"token-id","type":"string","info":null},"val":{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"escrow-account","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-escrow-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"fungible","type":{"modspec":[{"var":{"f":{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"i":null,"lit":"fungible"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"quote-spec","type":{"schema":"object","type":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-spec","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"quote"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null},{"args":[{"amArg":"`af15","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"r","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.OFFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-offer","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Offer policy of sale SALE-ID by SELLER of AMOUNT of TOKEN."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"q","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":" Executed at `offer` step of marmalade.ledger.                              Required msg-data keys:                                                         * (optional) quote:object{quote-spec} - sale is registered as a quoted fungible  sale if present. If absent, sale proceeds without quotes."},"info":null}}],["marmalade-v2.policy-manager.exists-msg-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"msg","type":"string","info":null}],"return":"bool"},"defName":"exists-msg-quote","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null},{"obj":{},"keyorder":[],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"o","type":{"schema":"object","type":"*","partial":"full"},"info":null},"val":{"args":[{"obj":{},"keyorder":[],"type":"*","i":null},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Checks env-data field and see if the msg is a object"},"info":null}}],["marmalade-v2.policy-manager.ROYALTY_POLICY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"ROYALTY_POLICY","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"royalty-policy"},"eval":{"var":{"direct":{"pdval":"royalty-policy"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.GOVERNANCE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"GOVERNANCE","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.BUYER-FUNGIBLE-ACCOUNT-MSG-KEY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"BUYER-FUNGIBLE-ACCOUNT-MSG-KEY","type":"string","info":null},"meta":{"model":[],"docs":"Payload field for buyer's fungible account"},"val":{"raw":{"i":null,"lit":"buyer_fungible_account"},"eval":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.MARKETPLACE-FEE-KEY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"MARKETPLACE-FEE-KEY","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":null},"meta":{"model":[],"docs":"Payload field for marketplace fee spec"},"val":{"raw":{"i":null,"lit":"marketplace_fee"},"eval":{"var":{"direct":{"pdval":"marketplace_fee"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.BUY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"BUY","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Capability to grant internal transaction inside BUY"},"info":null}}],["util.fungible-util.enforce-valid-account.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":null}],"return":{"tag":"TypeVar","name":"c","constraint":[]}},"defName":"enforce-valid-account","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"length"}},"i":null}},"i":null},"info":null},{"i":null,"lit":{"int":2}}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"minimum account length"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"fungible-util"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.enforce-buy.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"buyer-guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":{"list":"bool"}},"defName":"enforce-buy","defBody":{"scope":{"list":[{"args":[{"var":{"b":5},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-sale-pact.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":5},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"BUY-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-buy"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"args":[{"var":{"b":5},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.exists-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"updated_price"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.exists-msg-decimal.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"amount","type":"decimal","info":{"d":[6,3603,3603],"c":"amount"}}],"return":"bool"},"defName":"enforce-unit","defBody":{"scope":{"list":[],"type":"*","i":{"d":[120,3571,3571],"c":"(defun enforce-unit:bool\n     ( amount:decimal )\n     \" Enforce minimum precision allowed for transactions.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Enforce minimum precision allowed for transactions."},"info":{"d":[120,3571,3571],"c":"(defun enforce-unit:bool\n     ( amount:decimal )\n     \" Enforce minimum precision allowed for transactions.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null},{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.UPDATE-QUOTE-PRICE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quotes","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"obj":{"sale-price":{"var":{"b":0},"i":null}},"keyorder":["sale-price"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"pairs":[{"arg":{"name":"updated-price","type":"decimal","info":null},"val":{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"updated_price"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Price is not finalized for this quote"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":0},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.FUNGIBLE-TRANSFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"i":null,"lit":1}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"and"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Invalid market-fee percentage"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"mk-account"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"managed","type":"decimal","info":{"d":[7,780,780],"c":"managed"}},{"name":"requested","type":"decimal","info":{"d":[9,803,803],"c":"requested"}}],"return":"decimal"},"defName":"TRANSFER-mgr","defBody":{"scope":{"list":[],"type":"*","i":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Manages TRANSFER AMOUNT linearly,  such that a request for 1.0 amount on a 3.0  managed quantity emits updated amount 2.0."},"info":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"i":{"d":[18,721,721],"c":"TRANSFER-mgr\n     "}}},"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,489,489],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,510,510],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,533,533],"c":"amount"}}],"return":"bool"},"defName":"TRANSFER","defBody":{"scope":{"list":[],"type":"*","i":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Managed capability sealing AMOUNT for transfer from SENDER to  RECEIVER. Permits any number of transfers up to AMOUNT."},"info":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"install-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"mk-account"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,1126,1126],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,1146,1146],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,1168,1168],"c":"amount"}}],"return":"string"},"defName":"transfer","defBody":{"scope":{"list":[],"type":"*","i":{"d":[409,1097,1097],"c":"(defun transfer:string\n    ( sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n         \\ Fails if either SENDER or RECEIVER does not exist.\"\n    @model [ (property (> amount 0.0))\n             (property (!= sender \"\"))\n             (property (!= receiver \"\"))\n             (property (!= sender receiver))\n           ]\n    )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":{"d":[9,1333,1333],"c":"property "}},{"list":[{"atom":">","q":[],"i":{"d":[2,1343,1343],"c":"> "}},{"atom":"amount","q":[],"i":{"d":[7,1345,1345],"c":"amount "}},{"i":{"d":[3,1352,1352],"c":"0.0"},"lit":0}],"d":"()","i":{"d":[14,1342,1342],"c":"(> amount 0.0)"}}],"d":"()","i":{"d":[39,1332,1332],"c":"(property (> amount 0.0))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1372,1372],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1382,1382],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,1385,1385],"c":"sender "}},{"i":{"d":[2,1392,1392],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[14,1381,1381],"c":"(!= sender \"\")"}}],"d":"()","i":{"d":[39,1371,1371],"c":"(property (!= sender \"\"))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1411,1411],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1421,1421],"c":"!= "}},{"atom":"receiver","q":[],"i":{"d":[9,1424,1424],"c":"receiver "}},{"i":{"d":[2,1433,1433],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[16,1420,1420],"c":"(!= receiver \"\")"}}],"d":"()","i":{"d":[41,1410,1410],"c":"(property (!= receiver \"\"))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1452,1452],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1462,1462],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,1465,1465],"c":"sender "}},{"atom":"receiver","q":[],"i":{"d":[8,1472,1472],"c":"receiver"}}],"d":"()","i":{"d":[20,1461,1461],"c":"(!= sender receiver)"}}],"d":"()","i":{"d":[43,1451,1451],"c":"(property (!= sender receiver))\n           "}}],"docs":" Transfer AMOUNT between accounts SENDER and RECEIVER.  Fails if either SENDER or RECEIVER does not exist."},"info":{"d":[409,1097,1097],"c":"(defun transfer:string\n    ( sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n         \\ Fails if either SENDER or RECEIVER does not exist.\"\n    @model [ (property (> amount 0.0))\n             (property (!= sender \"\"))\n             (property (!= receiver \"\"))\n             (property (!= sender receiver))\n           ]\n    )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.FUNGIBLE-TRANSFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"managed","type":"decimal","info":{"d":[7,780,780],"c":"managed"}},{"name":"requested","type":"decimal","info":{"d":[9,803,803],"c":"requested"}}],"return":"decimal"},"defName":"TRANSFER-mgr","defBody":{"scope":{"list":[],"type":"*","i":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Manages TRANSFER AMOUNT linearly,  such that a request for 1.0 amount on a 3.0  managed quantity emits updated amount 2.0."},"info":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"i":{"d":[18,721,721],"c":"TRANSFER-mgr\n     "}}},"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,489,489],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,510,510],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,533,533],"c":"amount"}}],"return":"bool"},"defName":"TRANSFER","defBody":{"scope":{"list":[],"type":"*","i":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Managed capability sealing AMOUNT for transfer from SENDER to  RECEIVER. Permits any number of transfers up to AMOUNT."},"info":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"install-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"buyer_fungible_account"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"guard"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,1543,1543],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,1564,1564],"c":"receiver"}},{"name":"receiver-guard","type":{"guard":null},"info":{"d":[14,1587,1587],"c":"receiver-guard"}},{"name":"amount","type":"decimal","info":{"d":[6,1615,1615],"c":"amount"}}],"return":"string"},"defName":"transfer-create","defBody":{"scope":{"list":[],"type":"*","i":{"d":[656,1506,1506],"c":"(defun transfer-create:string\n     ( sender:string\n       receiver:string\n       receiver-guard:guard\n       amount:decimal\n     )\n     @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n          \\ Fails if SENDER does not exist. If RECEIVER exists, guard \\\n          \\ must match existing value. If RECEIVER does not exist, \\\n          \\ RECEIVER account is created using RECEIVER-GUARD. \\\n          \\ Subject to management by TRANSFER capability.\"\n     @model [ (property (> amount 0.0))\n              (property (!= sender \"\"))\n              (property (!= receiver \"\"))\n              (property (!= sender receiver))\n            ]\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":{"d":[9,1984,1984],"c":"property "}},{"list":[{"atom":">","q":[],"i":{"d":[2,1994,1994],"c":"> "}},{"atom":"amount","q":[],"i":{"d":[7,1996,1996],"c":"amount "}},{"i":{"d":[3,2003,2003],"c":"0.0"},"lit":0}],"d":"()","i":{"d":[14,1993,1993],"c":"(> amount 0.0)"}}],"d":"()","i":{"d":[40,1983,1983],"c":"(property (> amount 0.0))\n              "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,2024,2024],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,2034,2034],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,2037,2037],"c":"sender "}},{"i":{"d":[2,2044,2044],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[14,2033,2033],"c":"(!= sender \"\")"}}],"d":"()","i":{"d":[40,2023,2023],"c":"(property (!= sender \"\"))\n              "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,2064,2064],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,2074,2074],"c":"!= "}},{"atom":"receiver","q":[],"i":{"d":[9,2077,2077],"c":"receiver "}},{"i":{"d":[2,2086,2086],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[16,2073,2073],"c":"(!= receiver \"\")"}}],"d":"()","i":{"d":[42,2063,2063],"c":"(property (!= receiver \"\"))\n              "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,2106,2106],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,2116,2116],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,2119,2119],"c":"sender "}},{"atom":"receiver","q":[],"i":{"d":[8,2126,2126],"c":"receiver"}}],"d":"()","i":{"d":[20,2115,2115],"c":"(!= sender receiver)"}}],"d":"()","i":{"d":[44,2105,2105],"c":"(property (!= sender receiver))\n            "}}],"docs":" Transfer AMOUNT between accounts SENDER and RECEIVER.  Fails if SENDER does not exist. If RECEIVER exists, guard  must match existing value. If RECEIVER does not exist,  RECEIVER account is created using RECEIVER-GUARD.  Subject to management by TRANSFER capability."},"info":{"d":[656,1506,1506],"c":"(defun transfer-create:string\n     ( sender:string\n       receiver:string\n       receiver-guard:guard\n       amount:decimal\n     )\n     @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n          \\ Fails if SENDER does not exist. If RECEIVER exists, guard \\\n          \\ must match existing value. If RECEIVER does not exist, \\\n          \\ RECEIVER account is created using RECEIVER-GUARD. \\\n          \\ Subject to management by TRANSFER capability.\"\n     @model [ (property (> amount 0.0))\n              (property (!= sender \"\"))\n              (property (!= receiver \"\"))\n              (property (!= sender receiver))\n            ]\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.ESCROW.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"managed","type":"decimal","info":{"d":[7,780,780],"c":"managed"}},{"name":"requested","type":"decimal","info":{"d":[9,803,803],"c":"requested"}}],"return":"decimal"},"defName":"TRANSFER-mgr","defBody":{"scope":{"list":[],"type":"*","i":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Manages TRANSFER AMOUNT linearly,  such that a request for 1.0 amount on a 3.0  managed quantity emits updated amount 2.0."},"info":{"d":[352,745,745],"c":"(defun TRANSFER-mgr:decimal\n     ( managed:decimal\n       requested:decimal\n     )\n     @doc \" Manages TRANSFER AMOUNT linearly, \\\n          \\ such that a request for 1.0 amount on a 3.0 \\\n          \\ managed quantity emits updated amount 2.0.\"\n     )\n\n   ; ----------------------------------------------------------------------\n   ; Functionality\n\n\n  "}}},"i":{"d":[18,721,721],"c":"TRANSFER-mgr\n     "}}},"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,489,489],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,510,510],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,533,533],"c":"amount"}}],"return":"bool"},"defName":"TRANSFER","defBody":{"scope":{"list":[],"type":"*","i":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Managed capability sealing AMOUNT for transfer from SENDER to  RECEIVER. Permits any number of transfers up to AMOUNT."},"info":{"d":[285,460,460],"c":"(defcap TRANSFER:bool\n     ( sender:string\n       receiver:string\n       amount:decimal\n     )\n     @doc \" Managed capability sealing AMOUNT for transfer from SENDER to \\\n          \\ RECEIVER. Permits any number of transfers up to AMOUNT.\"\n     @managed amount TRANSFER-mgr\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"install-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sender","type":"string","info":{"d":[6,1126,1126],"c":"sender"}},{"name":"receiver","type":"string","info":{"d":[8,1146,1146],"c":"receiver"}},{"name":"amount","type":"decimal","info":{"d":[6,1168,1168],"c":"amount"}}],"return":"string"},"defName":"transfer","defBody":{"scope":{"list":[],"type":"*","i":{"d":[409,1097,1097],"c":"(defun transfer:string\n    ( sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n         \\ Fails if either SENDER or RECEIVER does not exist.\"\n    @model [ (property (> amount 0.0))\n             (property (!= sender \"\"))\n             (property (!= receiver \"\"))\n             (property (!= sender receiver))\n           ]\n    )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":{"d":[9,1333,1333],"c":"property "}},{"list":[{"atom":">","q":[],"i":{"d":[2,1343,1343],"c":"> "}},{"atom":"amount","q":[],"i":{"d":[7,1345,1345],"c":"amount "}},{"i":{"d":[3,1352,1352],"c":"0.0"},"lit":0}],"d":"()","i":{"d":[14,1342,1342],"c":"(> amount 0.0)"}}],"d":"()","i":{"d":[39,1332,1332],"c":"(property (> amount 0.0))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1372,1372],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1382,1382],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,1385,1385],"c":"sender "}},{"i":{"d":[2,1392,1392],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[14,1381,1381],"c":"(!= sender \"\")"}}],"d":"()","i":{"d":[39,1371,1371],"c":"(property (!= sender \"\"))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1411,1411],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1421,1421],"c":"!= "}},{"atom":"receiver","q":[],"i":{"d":[9,1424,1424],"c":"receiver "}},{"i":{"d":[2,1433,1433],"c":"\"\""},"lit":""}],"d":"()","i":{"d":[16,1420,1420],"c":"(!= receiver \"\")"}}],"d":"()","i":{"d":[41,1410,1410],"c":"(property (!= receiver \"\"))\n             "}},{"list":[{"atom":"property","q":[],"i":{"d":[9,1452,1452],"c":"property "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,1462,1462],"c":"!= "}},{"atom":"sender","q":[],"i":{"d":[7,1465,1465],"c":"sender "}},{"atom":"receiver","q":[],"i":{"d":[8,1472,1472],"c":"receiver"}}],"d":"()","i":{"d":[20,1461,1461],"c":"(!= sender receiver)"}}],"d":"()","i":{"d":[43,1451,1451],"c":"(property (!= sender receiver))\n           "}}],"docs":" Transfer AMOUNT between accounts SENDER and RECEIVER.  Fails if either SENDER or RECEIVER does not exist."},"info":{"d":[409,1097,1097],"c":"(defun transfer:string\n    ( sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \" Transfer AMOUNT between accounts SENDER and RECEIVER. \\\n         \\ Fails if either SENDER or RECEIVER does not exist.\"\n    @model [ (property (> amount 0.0))\n             (property (!= sender \"\"))\n             (property (!= receiver \"\"))\n             (property (!= sender receiver))\n           ]\n    )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"balance","type":"decimal","info":null},"val":{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":{"d":[7,3216,3216],"c":"account"}}],"return":"decimal"},"defName":"get-balance","defBody":{"scope":{"list":[],"type":"*","i":{"d":[128,3182,3182],"c":"(defun get-balance:decimal\n     ( account:string )\n     \" Get balance for ACCOUNT. Fails if account does not exist.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Get balance for ACCOUNT. Fails if account does not exist."},"info":{"d":[128,3182,3182],"c":"(defun get-balance:decimal\n     ( account:string )\n     \" Get balance for ACCOUNT. Fails if account does not exist.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}}],"type":"let","i":null},{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"result","type":{"list":"bool"},"info":null},"val":{"args":[{"amArg":"`af21","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"x","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.BUY-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":3},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"buyer-guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-buy","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Buy policy on SALE-ID by SELLER to BUYER AMOUNT of TOKEN."},"info":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"w","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"mk-fee","type":"decimal","info":null},"val":{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"*"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":"integer"},"defName":"precision","defBody":{"scope":{"list":[],"type":"*","i":{"d":[97,3474,3474],"c":"(defun precision:integer\n     ()\n     \"Return the maximum allowed decimal precision.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":"Return the maximum allowed decimal precision."},"info":{"d":[97,3474,3474],"c":"(defun precision:integer\n     ()\n     \"Return the maximum allowed decimal precision.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"floor"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"mk-fee-percentage","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":"mk-fee-percentage"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"mk-fee-spec","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"marketplace-fee-spec","meta":{"model":[],"docs":"Marketplace fee data to include in payload"},"i":null,"fields":[{"name":"mk-account","type":"string","info":null},{"name":"mk-fee-percentage","type":"decimal","info":null}]}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"obj":{"mk-account":{"i":null,"lit":""},"mk-fee-percentage":{"i":null,"lit":0}},"keyorder":["mk-account","mk-fee-percentage"],"type":"*","i":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marketplace_fee"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"final-sale-price","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":"sale-price"},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":5},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-price","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":"sale-price"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-type","type":"string","info":null},"val":{"args":[{"i":null,"lit":"sale-type"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"i":null,"lit":"seller-fungible-account"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"fungible","type":{"modspec":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}},"i":null}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"i":null,"lit":"fungible"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"quote-spec","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"f":{"var":{"b":5},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"escrow-account","type":{"schema":"object","type":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"b":5},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-escrow-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af24","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":5},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"aa","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.BUY-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":5},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"buyer-guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-buy","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Buy policy on SALE-ID by SELLER to BUYER AMOUNT of TOKEN."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"z","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":" Executed at `buy` step of marmalade.ledger.                                  Required msg-data keys:                                                           * (optional) buyer_fungible_account:string - The fungible account of the buyer    which transfers the fungible to the escrow account. Only required if the sale is  a quoted sale. "},"info":null}}],["marmalade-v2.policy-manager.WITHDRAW-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"WITHDRAW-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledger","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"ledger-impl","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}]}}],["marmalade-v2.policy-manager.UPDATE-URI-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"new-uri","type":"string","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"UPDATE-URI-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.CONCRETE_POLICY_LIST.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"CONCRETE_POLICY_LIST","type":{"list":"string"},"info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"list":[{"var":{"ref":{"var":{"direct":{"pdval":"non-fungible-policy"}},"i":null}},"i":null},{"var":{"ref":{"var":{"direct":{"pdval":"royalty-policy"}},"i":null}},"i":null},{"var":{"ref":{"var":{"direct":{"pdval":"collection-policy"}},"i":null}},"i":null},{"var":{"ref":{"var":{"direct":{"pdval":"guard-policy"}},"i":null}},"i":null}],"type":{"tag":"TypeVar","name":"f","constraint":[]},"i":null},"eval":{"var":{"direct":{"pdval":["non-fungible-policy","royalty-policy","collection-policy","guard-policy"]}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.enforce-burn.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"list":"bool"}},"defName":"enforce-burn","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"BURN-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-burn"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af12","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"o","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.BURN-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-burn","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Burning policy for TOKEN to ACCOUNT for AMOUNT."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"n","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.get-escrow-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"}},"defName":"get-escrow-account","defBody":{"scope":{"list":[{"obj":{"guard":{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.ESCROW.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-capability-guard"}},"i":null}},"i":null},"info":null},"account":{"args":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.ESCROW.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-capability-guard"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-principal"}},"i":null}},"i":null},"info":null}},"keyorder":["account","guard"],"type":"*","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Returns fungible escrow ACCOUNT and GUARD of the SALE"},"info":null}}],["util.fungible-util.check-reserved.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":null}],"return":"string"},"defName":"check-reserved","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":":"},{"args":[{"i":null,"lit":{"int":-1}},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"take"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":{"int":1}},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"take"}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"pfx","type":{"tag":"TypeVar","name":"f","constraint":[]},"info":null},"val":{"args":[{"i":null,"lit":{"int":2}},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"take"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"fungible-util"},"meta":{"model":[],"docs":" Checks ACCOUNT for reserved name and returns type if  found or empty string. Reserved names start with a  single char and colon, e.g. 'c:foo', which would return 'c' as type."},"info":null}}],["marmalade-v2.policy-manager.OFFER.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"OFFER","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Capability to grant internal transaction inside OFFER"},"info":null}}],["marmalade-v2.policy-manager.NON_FUNGIBLE_POLICY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"NON_FUNGIBLE_POLICY","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"non-fungible-policy"},"eval":{"var":{"direct":{"pdval":"non-fungible-policy"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.exists-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"exists-quote","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":false},{"body":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"pairs":[{"arg":{"name":"q","type":{"tag":"TypeVar","name":"ah","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Looks up quote table for quote"},"info":null}}],["marmalade-v2.policy-manager.OFFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"OFFER-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.ESCROW.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":{"tag":"TypeVar","name":"c","constraint":[]}},"defName":"ESCROW","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Capability to be used as escrow's capability guard"},"info":null}}],["util.fungible-util.enforce-precision.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"precision","type":"integer","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"enforce-precision","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"var":{"b":1},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"floor"}},"i":null}},"i":null},"info":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"i":null,"lit":"precision violation"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"fungible-util"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.init.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"ledger","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}],"return":"bool"},"defName":"init","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.GOVERNANCE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledgers","meta":{"model":[],"docs":"Singleton table for ledger reference storage"},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledger","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"ledger-impl","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"i":null,"lit":""},{"obj":{"ledger-impl":{"var":{"b":0},"i":null}},"keyorder":["ledger-impl"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"write"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Must be initiated with ledger implementation"},"info":null}}],["marmalade-v2.policy-manager.quote-spec.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-spec","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}}],["marmalade-v2.policy-manager.write-concrete-policy.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"policy-field","type":"string","info":null},{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}],"return":"bool"},"defName":"write-concrete-policy","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":["non-fungible-policy","royalty-policy","collection-policy","guard-policy"]}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"contains"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Not registered as concrete policy"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.CONCRETE-POLICY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policies","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policy","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"policy":{"var":{"b":1},"i":null}},"keyorder":["policy"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"write"}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"partial":"full"}},"defName":"get-quote-info","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quotes","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Get Quote information"},"info":null}}],["marmalade-v2.policy-manager.get-concrete-policy.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"policy-field","type":"string","info":null}],"return":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"defName":"get-concrete-policy","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policies","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policy","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"policy","type":{"tag":"TypeVar","name":"ak","constraint":[]},"info":null},"val":{"i":null,"lit":"policy"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.FUNGIBLE-TRANSFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null}],"return":"bool"},"defName":"FUNGIBLE-TRANSFER-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.COLLECTION_POLICY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"COLLECTION_POLICY","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"collection-policy"},"eval":{"var":{"direct":{"pdval":"collection-policy"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.enforce-withdraw.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":{"list":"bool"}},"defName":"enforce-withdraw","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"WITHDRAW-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-withdraw"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-sale-pact.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.exists-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":4},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-withdrawal","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"sale-v2"},"meta":{"model":[],"docs":"Read-only Function that is enforced to allow withdrawal from sale"},"info":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-contract","type":{"modspec":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}},"i":null}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-sale.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-type","type":"string","info":null},"val":{"args":[{"i":null,"lit":"sale-type"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"quote-spec","type":{"schema":"object","type":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.get-quote-info.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null},{"args":[{"amArg":"`af18","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"u","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.WITHDRAW-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"enforce-withdraw","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Withdraw policy on SALE-ID by SELLER of AMOUNT of TOKEN"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"t","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":" Executed at `withdraw` step of marmalade.ledger."},"info":null}}],["marmalade-v2.policy-manager.enforce-update-uri.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"new-uri","type":"string","info":null}],"return":{"list":"bool"}},"defName":"enforce-update-uri","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"new-uri","type":"string","info":null}],"return":"bool"},"defName":"UPDATE-URI-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-update-uri"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af30","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"ag","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.UPDATE-URI-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"new-uri","type":"string","info":null}],"return":"bool"},"defName":"enforce-update-uri","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"updatable-uri-policy-v1"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"new-uri","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Updating the URI of a token."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null},{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"updatable-uri-policy-v1"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"af","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.fungible-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}}],["util.fungible-util.enforce-valid-transfer.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"enforce-valid-transfer","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null},"info":null},{"i":null,"lit":"sender cannot be the receiver of a transfer"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":2},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.enforce-valid-amount.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.enforce-valid-account.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.enforce-valid-account.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"fungible-util"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.marketplace-fee-spec.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"marketplace-fee-spec","meta":{"model":[],"docs":"Marketplace fee data to include in payload"},"i":null,"fields":[{"name":"mk-account","type":"string","info":null},{"name":"mk-fee-percentage","type":"decimal","info":null}]}}],["marmalade-v2.policy-manager.SALE-GUARD-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null},{"name":"price","type":"decimal","info":null}],"return":"bool"},"defName":"SALE-GUARD-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.sale-contract.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-contract","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}]}}],["marmalade-v2.policy-manager.BURN-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"BURN-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.sale-whitelist.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-whitelist","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-contract","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}}],["marmalade-v2.policy-manager.enforce-sale-pact.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale","type":"string","info":null}],"return":"bool"},"defName":"enforce-sale-pact","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Invalid pact/sale id"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Enforces that SALE is id for currently executing pact"},"info":null}}],["marmalade-v2.policy-manager.SALE-WHITELIST.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"sale-contract-key","type":"string","info":null}],"return":"bool"},"defName":"SALE-WHITELIST","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]}},"defName":"retrieve-ledger","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledgers","meta":{"model":[],"docs":"Singleton table for ledger reference storage"},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledger","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"ledger-impl","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"i":null,"lit":""},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"tag":"TypeVar","name":"ai","constraint":[]},"info":null},"val":{"i":null,"lit":"ledger-impl"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Retrieves the ledger implementation"},"info":null}}],["marmalade-v2.policy-manager.ledgers.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledgers","meta":{"model":[],"docs":"Singleton table for ledger reference storage"},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"ledger","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"ledger-impl","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}}],["marmalade-v2.policy-manager.quote-schema.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}}],["marmalade-v2.policy-manager.UPDATE-QUOTE-PRICE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"token-id","type":"string","info":null},{"name":"sale-id","type":"string","info":null},{"name":"sale-type","type":"string","info":null},{"name":"updated-price","type":"decimal","info":null}],"return":"bool"},"defName":"UPDATE-QUOTE-PRICE","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":3},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"QUOTE price must be positive"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":1},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.SALE-GUARD-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null},{"name":"price","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-quote-update","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"sale-v2"},"meta":{"model":[],"docs":"Read-only Function that is enforced to update quote price at enforce-buy"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-contract","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-sale.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Enforces sale-guard on update-quote-price"},"info":null}}],["marmalade-v2.policy-manager.INIT-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"INIT-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.enforce-mint.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null}],"return":{"list":"bool"}},"defName":"enforce-mint","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"MINT-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-mint"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af9","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"l","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.MINT-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-mint","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Minting policy for TOKEN to ACCOUNT for AMOUNT."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"k","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["util.fungible-util.GOVERNANCE.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"GOVERNANCE","defBody":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":"util-ns-admin"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"keyset-ref-guard"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"fungible-util"},"meta":{"model":[],"docs":null},"info":null}}],["util.fungible-util.enforce-reserved.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}],"return":"bool"},"defName":"enforce-reserved","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"validate-principal"}},"i":null}},"i":null},"info":null},{"i":null,"lit":true},{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true},{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":"k"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":false},{"i":null,"lit":"Single-key account protocol violation"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":false},{"args":[{"i":null,"lit":"Reserved protocol guard violation: {}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"h","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"r","type":{"tag":"TypeVar","name":"g","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.check-reserved.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"fungible-util"},"meta":{"model":[],"docs":"Enforce reserved account name protocols. Enforce reserved account name protocols. Implementations  must call this function in all account creation modes  (transfer-create, create-account, etc)."},"info":null}}],["marmalade-v2.policy-manager.retrieve-sale.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-type","type":"string","info":null}],"return":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]}},"defName":"retrieve-sale","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-whitelist","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-contract","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale","type":{"tag":"TypeVar","name":"aj","constraint":[]},"info":null},"val":{"i":null,"lit":"sale-contract"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Retrieves the sale-contract"},"info":null}}],["marmalade-v2.policy-manager.enforce-transfer.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sender","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"list":"bool"}},"defName":"enforce-transfer","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"TRANSFER-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-transfer"},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af27","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"ad","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.TRANSFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sender","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-transfer","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":" Enforce rules on transfer of TOKEN AMOUNT from SENDER to RECEIVER.  Also governs rotate of SENDER (with same RECEIVER and 0.0 AMOUNT). "},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"ac","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.UPDATED-PRICE-KEY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"UPDATED-PRICE-KEY","type":"string","info":null},"meta":{"model":[],"docs":"Payload field for updated price"},"val":{"raw":{"i":null,"lit":"updated_price"},"eval":{"var":{"direct":{"pdval":"updated_price"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.add-sale-whitelist.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}],"return":"bool"},"defName":"add-sale-whitelist","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.SALE-WHITELIST.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-whitelist","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"sale-contract","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"sale-contract","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"sale-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"sale-contract":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"keyorder":["sale-contract"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-key","type":{"tag":"TypeVar","name":"d","constraint":[]},"info":null},"val":{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"e","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Adds quote-guard to quote-guard-whitelist list"},"info":null}}],["util.fungible-util.enforce-valid-amount.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"precision","type":"integer","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"tag":"TypeVar","name":"b","constraint":[]}},"defName":"enforce-valid-amount","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Positive non-zero amount"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.enforce-precision.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"util","name":"fungible-util"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.validate-fungible-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null}],"return":{"tag":"TypeVar","name":"al","constraint":[]}},"defName":"validate-fungible-account","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"guard"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"guard"},{"var":{"f":{"var":{"b":1},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Account guard does not match"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"seller-details","type":{"tag":"TypeVar","name":"am","constraint":[]},"info":null},"val":{"args":[{"args":[{"i":null,"lit":"account"},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"account","type":"string","info":{"d":[7,3356,3356],"c":"account"}}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":null,"name":"fungible-v2"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":{"d":[10,283,283],"c":"invariant "}},{"list":[{"atom":"!=","q":[],"i":{"d":[3,294,294],"c":"!= "}},{"i":{"d":[3,297,297],"c":"\"\" "},"lit":""},{"atom":"sender","q":[],"i":{"d":[6,300,300],"c":"sender"}}],"d":"()","i":{"d":[14,293,293],"c":"(!= \"\" sender)"}}],"d":"()","i":{"d":[27,282,282],"c":"(invariant (!= \"\" sender)) "}}],"docs":"Schema for results of 'account' operation."},"i":{"d":[272,188,188],"c":"(defschema account-details\n    @doc \"Schema for results of 'account' operation.\"\n    @model [ (invariant (!= \"\" sender)) ]\n\n    account:string\n    balance:decimal\n    guard:guard)\n\n\n   ; ----------------------------------------------------------------------\n   ; Caps\n\n   "},"fields":[{"name":"account","type":"string","info":{"d":[7,316,316],"c":"account"}},{"name":"balance","type":"decimal","info":{"d":[7,335,335],"c":"balance"}},{"name":"guard","type":{"guard":null},"info":{"d":[5,355,355],"c":"guard"}}]}},"i":{"d":[15,3332,3332],"c":"account-details"}},"partial":"full"}},"defName":"details","defBody":{"scope":{"list":[],"type":"*","i":{"d":[164,3310,3310],"c":"(defun details:object{account-details}\n     ( account: string )\n     \" Get an object with details of ACCOUNT. \\\n     \\ Fails if account does not exist.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Get an object with details of ACCOUNT.  Fails if account does not exist."},"info":{"d":[164,3310,3310],"c":"(defun details:object{account-details}\n     ( account: string )\n     \" Get an object with details of ACCOUNT. \\\n     \\ Fails if account does not exist.\"\n     )\n\n   "}}},"i":null}},"i":null}},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.QUOTE.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"sale-id","type":"string","info":null},{"name":"token-id","type":"string","info":null},{"name":"spec","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-spec","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"partial":"full"},"info":null}],"return":"bool"},"defName":"QUOTE","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.CONCRETE-POLICY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"policy-field","type":"string","info":null},{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}],"return":"bool"},"defName":"CONCRETE-POLICY","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.exists-msg-decimal.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"msg","type":"string","info":null}],"return":"bool"},"defName":"exists-msg-decimal","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":-1}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"d","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":-1},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"try"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Checks env-data field and see if the msg is a decimal"},"info":null}}],["marmalade-v2.policy-manager.WITHDRAW.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"WITHDRAW","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":"Capability to grant internal transaction inside WITHDRAW"},"info":null}}],["marmalade-v2.policy-manager.concrete-policy.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policy","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}]}}],["marmalade-v2.policy-manager.ADMIN-KS.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"ADMIN-KS","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"marmalade-v2.marmalade-contract-admin"},"eval":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.GUARD_POLICY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"GUARD_POLICY","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"guard-policy"},"eval":{"var":{"direct":{"pdval":"guard-policy"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.validate-quote.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"quote-spec","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"partial":"full"},"info":null}],"return":"bool"},"defName":"validate-quote","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.validate-fungible-account.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":0},"i":null}],"fun":{"dref":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"amount","type":"decimal","info":{"d":[6,3603,3603],"c":"amount"}}],"return":"bool"},"defName":"enforce-unit","defBody":{"scope":{"list":[],"type":"*","i":{"d":[120,3571,3571],"c":"(defun enforce-unit:bool\n     ( amount:decimal )\n     \" Enforce minimum precision allowed for transactions.\"\n     )\n\n   "}}},"module":{"namespace":null,"name":"fungible-v2"},"meta":{"model":[],"docs":" Enforce minimum precision allowed for transactions."},"info":{"d":[120,3571,3571],"c":"(defun enforce-unit:bool\n     ( amount:decimal )\n     \" Enforce minimum precision allowed for transactions.\"\n     )\n\n   "}}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Offer price must be positive"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-sale.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Offer price must be positive or zero"}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":{"tag":"TypeVar","name":"an","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-price","type":"decimal","info":null},"val":{"args":[{"i":null,"lit":"sale-price"},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sale-type","type":"string","info":null},"val":{"args":[{"i":null,"lit":"sale-type"},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"f":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"args":[{"i":null,"lit":"seller-fungible-account"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"fungible","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[{"i":null,"lit":"fungible"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.MINT-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"MINT-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.BUY-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"BUY-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.quotes.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quotes","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"quote-schema","meta":{"model":[],"docs":"Quote spec of the sale"},"i":null,"fields":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"seller","type":"string","info":null},{"name":"timeout","type":"integer","info":null},{"name":"fungible","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":null,"name":"fungible-v2"}}},"i":null}]},"info":null},{"name":"seller-fungible-account","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"fungible-account","meta":{"model":[],"docs":"account and guard information of a fungible"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"sale-price","type":"decimal","info":null},{"name":"sale-type","type":"string","info":null}]}},"i":null},"i":null}}],["marmalade-v2.policy-manager.enforce-init.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null}],"return":{"list":"bool"}},"defName":"enforce-init","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"precision"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"uri"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null}],"return":"bool"},"defName":"INIT-CALL","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger-v2"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-init "},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"ledger","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"marmalade-v2","name":"ledger-v2"}}},"i":null}},"i":null}]},"info":null},"val":{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.retrieve-ledger.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"amArg":"`af6","amInfo":null,"amBindBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"i":null,"lit":"id"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"precision"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"uri"},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"i","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.INIT-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"dref":{"var":{"b":0},"i":null},"i":null,"dmem":{"var":{"f":{"var":{"f":{"var":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null}],"return":"bool"},"defName":"enforce-init","defBody":{"scope":{"list":[],"type":"*","i":null}},"module":{"namespace":"kip","name":"token-policy-v2"},"meta":{"model":[],"docs":"Enforce policy on TOKEN initiation."},"info":null}},"i":null}},"i":null}},"i":null}},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"amTy":{"args":[{"name":"policy","type":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]},"info":null}],"return":{"tag":"TypeVar","name":"h","constraint":[]}}},{"args":[{"i":null,"lit":"policies"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"map"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.TRANSFER-CALL.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"policy","type":"string","info":null}],"return":"bool"},"defName":"TRANSFER-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"policy-manager"},"meta":{"model":[],"docs":null},"info":null}}],["marmalade-v2.policy-manager.QUOTE-MSG-KEY.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"arg":{"name":"QUOTE-MSG-KEY","type":"string","info":null},"meta":{"model":[],"docs":"Payload field for quote spec"},"val":{"raw":{"i":null,"lit":"quote"},"eval":{"var":{"direct":{"pdval":"quote"}},"i":null}},"i":null}}],["marmalade-v2.policy-manager.concrete-policies.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}",{"ref":{"hash":"h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o","modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policies","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"policy-manager"},"name":"concrete-policy","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"policy","type":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]},"info":null}]}},"i":null},"i":null}}]],"module":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","blessed":[],"interfaces":[{"namespace":"kip","name":"poly-fungible-v3"},{"namespace":"marmalade-v2","name":"ledger-v2"}],"imports":[{"hash":null,"imports":null,"module":{"namespace":"marmalade-v2","name":"policy-manager"},"i":null},{"hash":null,"imports":null,"module":{"namespace":"util","name":"fungible-util"},"i":null},{"hash":null,"imports":["token-info"],"module":{"namespace":"kip","name":"token-policy-v2"},"i":null},{"hash":null,"imports":["account-details","sender-balance-change","receiver-balance-change"],"module":{"namespace":"kip","name":"poly-fungible-v3"},"i":null}],"name":{"namespace":"marmalade-v2","name":"ledger"},"code":"(module ledger GOVERNANCE\n\n  @model\n    [\n      (defproperty valid-account (account:string)\n          (> (length account) 2))\n    ]\n\n  (implements marmalade-v2.ledger-v2)\n  (implements kip.poly-fungible-v3)\n\n  (use kip.poly-fungible-v3 [account-details sender-balance-change receiver-balance-change])\n  (use kip.token-policy-v2 [token-info])\n  (use util.fungible-util)\n  (use marmalade-v2.policy-manager)\n\n  ;; Version\n\n  (defconst VERSION:integer 1)\n\n  ;;\n  ;; Tables/Schemas\n  ;;\n\n  (deftable ledger:{account-details})\n\n  (defschema token-schema\n    id:string\n    uri:string\n    precision:integer\n    supply:decimal\n    policies:[module{kip.token-policy-v2}]\n  )\n\n  (defschema token-details\n    uri:string\n    precision:integer\n    policies:[module{kip.token-policy-v2}]\n  )\n\n  (defschema version\n    version:integer\n  )\n\n  (deftable tokens:{token-schema})\n  (deftable versions:{version})\n\n  ;;\n  ;; Governance\n  ;;\n\n  (defconst ADMIN-KS:string \"marmalade-v2.marmalade-contract-admin\")\n\n  (defcap GOVERNANCE ()\n    (enforce-guard ADMIN-KS))\n\n  ;;\n  ;; poly-fungible-v3 caps\n  ;;\n\n  (defcap TRANSFER:bool\n    ( id:string\n      sender:string\n      receiver:string\n      amount:decimal\n    )\n    @managed amount TRANSFER-mgr\n    (enforce-unit id amount)\n    (enforce (> amount 0.0) \"Amount must be positive\")\n    (compose-capability (DEBIT id sender))\n    (compose-capability (CREDIT id receiver))\n  )\n\n  (defcap XTRANSFER:bool\n    ( id:string\n      sender:string\n      receiver:string\n      target-chain:string\n      amount:decimal\n    )\n    @managed amount TRANSFER-mgr\n    (enforce false \"cross chain not supported\")\n  )\n\n  (defun TRANSFER-mgr:decimal\n    ( managed:decimal\n      requested:decimal\n    )\n    (let ((newbal (- managed requested)))\n      (enforce (>= newbal 0.0)\n        (format \"TRANSFER exceeded for balance {}\" [managed]))\n      newbal)\n  )\n\n  (defcap SUPPLY:bool (id:string supply:decimal)\n    @doc \" Emitted when supply is updated, if supported.\"\n    @event true\n  )\n\n  (defcap CREATE-TOKEN:bool (id:string)\n    true\n  )\n\n  (defcap TOKEN:bool (id:string precision:integer policies:[module{kip.token-policy-v2}] uri:string creation-guard:guard)\n    @event\n    true\n  )\n\n  (defcap RECONCILE:bool\n    ( token-id:string\n      amount:decimal\n      sender:object{sender-balance-change}\n      receiver:object{receiver-balance-change}\n    )\n    @doc \" For accounting via events. \\\n         \\ sender = {account: '', previous: 0.0, current: 0.0} for mint \\\n         \\ receiver = {account: '', previous: 0.0, current: 0.0} for burn\"\n    @event\n    true\n  )\n\n  (defcap ACCOUNT_GUARD:bool (id:string account:string guard:guard)\n    @doc \" Emitted when ACCOUNT guard is updated.\"\n    @event\n    true\n  )\n\n  ;;\n  ;; ledger-v2 caps to be able to validate access to policy operations.\n  ;;\n\n  (defcap INIT-CALL:bool (id:string precision:integer uri:string)\n    true\n  )\n\n  (defcap TRANSFER-CALL:bool (id:string sender:string receiver:string amount:decimal)\n    true\n  )\n\n  (defcap MINT-CALL:bool (id:string account:string amount:decimal)\n    true\n  )\n\n  (defcap BURN-CALL:bool (id:string account:string amount:decimal)\n    true\n  )\n\n  (defcap UPDATE-URI-CALL:bool (id:string new-uri:string)\n    true\n  )\n\n  (defcap OFFER-CALL:bool (id:string seller:string amount:decimal timeout:integer sale-id:string)\n    true\n  )\n\n  (defcap WITHDRAW-CALL:bool (id:string seller:string amount:decimal timeout:integer sale-id:string)\n    true\n  )\n\n  (defcap BUY-CALL:bool (id:string seller:string buyer:string amount:decimal sale-id:string)\n    true\n  )\n\n  ;;\n  ;; Implementation caps\n  ;;\n\n  (defcap DEBIT (id:string sender:string)\n    (enforce-guard (account-guard id sender))\n  )\n\n  (defcap CREDIT (id:string receiver:string) true)\n\n  (defcap UPDATE_SUPPLY ()\n    \"private cap for update-supply\"\n    true)\n\n  (defcap MINT:bool (id:string account:string amount:decimal)\n    @managed ;; one-shot for a given amount\n    (enforce (< 0.0 amount) \"Amount must be positive\")\n    (compose-capability (CREDIT id account))\n    (compose-capability (UPDATE_SUPPLY))\n  )\n\n  (defcap BURN (id:string account:string amount:decimal)\n    @managed ;; one-shot for a given amount\n    (enforce (< 0.0 amount) \"Amount must be positive\")\n    (compose-capability (DEBIT id account))\n    (compose-capability (UPDATE_SUPPLY))\n  )\n\n  (defcap UPDATE-URI:bool\n    ( token-id:string\n      new-uri:string\n    )\n    @managed\n    true\n  )\n\n  ;; Marmalade Functions\n\n  (defun create-token:bool\n    ( id:string\n      precision:integer\n      uri:string\n      policies:[module{kip.token-policy-v2}]\n      creation-guard:guard\n    )\n    @doc \"Initializes a TOKEN with given policies and parameters, \\\n    \\ and executes the enforce-init function for each listed policy.\"\n    ;; enforces token and uri protocols\n    (enforce-uri-reserved uri)\n    (let ((token-details { 'uri: uri, 'precision: precision, 'policies: (sort policies) }))\n      (enforce-token-reserved id token-details creation-guard)\n    )\n    (with-capability (INIT-CALL id precision uri)\n      ;; maps policy list and calls policy::enforce-init\n      (marmalade-v2.policy-manager.enforce-init\n        { 'id: id, 'supply: 0.0, 'precision: precision, 'uri: uri,  'policies: policies})\n    )\n    (with-capability (CREATE-TOKEN id)\n      (enforce-guard creation-guard)\n      (insert tokens id {\n        \"id\": id,\n        \"uri\": uri,\n        \"precision\": precision,\n        \"supply\": 0.0,\n        \"policies\": policies\n      })\n      (insert versions id {\n        \"version\": VERSION\n      })\n      (emit-event (TOKEN id precision policies uri creation-guard))\n    )\n  )\n\n  (defun mint:bool\n    ( id:string\n      account:string\n      guard:guard\n      amount:decimal\n    )\n    @doc \"Mints an AMOUNT of TOKEN to the provided ACCOUNT and its guard,\\\n    \\ and executes the enforce-mint policy functions.\"\n    (with-capability (MINT-CALL id account amount)\n      (marmalade-v2.policy-manager.enforce-mint (get-token-info id) account guard amount)\n    )\n    (with-capability (MINT id account amount)\n      (let\n        (\n          (receiver (credit id account guard amount))\n          (sender:object{sender-balance-change}\n            {'account: \"\", 'previous: 0.0, 'current: 0.0})\n        )\n        (emit-event (RECONCILE id amount sender receiver))\n        (update-supply id amount)\n      ))\n  )\n\n  (defun burn:bool\n    ( id:string\n      account:string\n      amount:decimal\n    )\n    @doc \"Burns an AMOUNT of TOKEN from the specified ACCOUNT,\\\n    \\ and executes the enforce-burn policy functions\"\n    (with-capability (BURN-CALL id account amount)\n      (marmalade-v2.policy-manager.enforce-burn (get-token-info id) account amount)\n    )\n    (with-capability (BURN id account amount)\n      (let\n        (\n          (sender (debit id account amount))\n          (receiver:object{receiver-balance-change}\n            {'account: \"\", 'previous: 0.0, 'current: 0.0})\n        )\n        (emit-event (RECONCILE id amount sender receiver))\n        (update-supply id (- amount))\n      ))\n  )\n\n  (defun transfer:bool\n    ( id:string\n      sender:string\n      receiver:string\n      amount:decimal\n    )\n    @doc \"Transfers an AMOUNT of TOKEN from the sender ACCOUNT \\\n    \\ to an existing receiver ACCOUNT, and executes the enforce-transfer \\\n    \\ policy functions.\"\n\n    (enforce (!= sender receiver)\n      \"sender cannot be the receiver of a transfer\")\n    (enforce-valid-transfer sender receiver (precision id) amount)\n    (with-capability (TRANSFER-CALL id sender receiver amount)\n      (marmalade-v2.policy-manager.enforce-transfer (get-token-info id) sender (account-guard id sender) receiver amount)\n    )\n    (with-capability (TRANSFER id sender receiver amount)\n      (with-read ledger (key id receiver)\n        { \"guard\" := g }\n        (let\n          ( (sender (debit id sender amount))\n            (receiver (credit id receiver g amount))\n          )\n          (emit-event (RECONCILE id amount sender receiver))\n        )\n      ))\n  )\n\n  (defun transfer-create:bool\n    ( id:string\n      sender:string\n      receiver:string\n      receiver-guard:guard\n      amount:decimal\n    )\n    @doc \"Transfers an AMOUNT of TOKEN from the sender ACCOUNT \\\n    \\ to the receiver ACCOUNT, creates an account if non-existent \\\n    \\ , and executes the enforce-transfer policy functions.\"\n\n    (enforce (!= sender receiver)\n      \"sender cannot be the receiver of a transfer\")\n    (enforce-valid-transfer sender receiver (precision id) amount)\n    (with-capability (TRANSFER-CALL id sender receiver amount)\n      (marmalade-v2.policy-manager.enforce-transfer (get-token-info id) sender (account-guard id sender) receiver amount)\n    )\n    (with-capability (TRANSFER id sender receiver amount)\n      (let\n        (\n          (sender (debit id sender amount))\n          (receiver (credit id receiver receiver-guard amount))\n        )\n        (emit-event (RECONCILE id amount sender receiver))\n      ))\n  )\n\n  (defun update-uri:bool\n    ( id:string\n      new-uri:string\n    )\n    @doc \"Updates the URI of the token, and executes enforce-update-uri \\\n    \\ policy functions.\"\n\n    (let ((version:integer (get-version id)))\n      (enforce (> version 0) \"updatable-uri not supported\"))\n    (with-capability (UPDATE-URI-CALL id new-uri)\n      (marmalade-v2.policy-manager.enforce-update-uri (get-token-info id) new-uri)\n    )\n    (with-capability (UPDATE-URI id new-uri)\n      (update tokens id { 'uri: new-uri })\n    )\n    true\n  )\n\n  ;; Implementation Functions\n\n  (defun debit:object{sender-balance-change}\n    ( id:string\n      account:string\n      amount:decimal\n    )\n\n    (require-capability (DEBIT id account))\n\n    (enforce-unit id amount)\n\n    (with-read ledger (key id account)\n      { \"balance\" := old-bal }\n\n      (enforce (<= amount old-bal) \"Insufficient funds\")\n\n      (let ((new-bal (- old-bal amount)))\n        (update ledger (key id account)\n          { \"balance\" : new-bal }\n          )\n        {'account: account, 'previous: old-bal, 'current: new-bal}\n      ))\n  )\n\n  (defun credit:object{receiver-balance-change}\n    ( id:string\n      account:string\n      guard:guard\n      amount:decimal\n    )\n    @doc \"Credit AMOUNT to ACCOUNT balance\"\n\n    @model [ (property (> amount 0.0))\n             (property (valid-account account))\n           ]\n    (enforce-reserved account guard)\n    (enforce-unit id amount)\n\n    (require-capability (CREDIT id account))\n\n    (with-default-read ledger (key id account)\n      { \"balance\" : -1.0 }\n      { \"balance\" := old-bal }\n\n      (let* ((is-new:bool\n               (= old-bal -1.0))\n             (old-bal:decimal (if is-new 0.0 old-bal))\n             (new-bal:decimal  (+ old-bal amount)))\n        (write ledger (key id account)\n           { \"balance\" : new-bal\n           , \"guard\"   : guard\n           , \"id\" : id\n           , \"account\" : account\n           })\n        (if is-new (emit-event (ACCOUNT_GUARD id account guard)) true)\n        {'account: account, 'previous: old-bal, 'current: new-bal}\n      ))\n    )\n\n  (defun credit-account:object{receiver-balance-change}\n    ( id:string\n      account:string\n      amount:decimal\n    )\n    @doc \"Credit AMOUNT to ACCOUNT\"\n    (credit id account (account-guard id account) amount)\n  )\n\n  (defun update-supply:bool (id:string amount:decimal)\n    (require-capability (UPDATE_SUPPLY))\n    (with-default-read tokens id\n      { 'supply: 0.0 }\n      { 'supply := s }\n      (let ((new-supply (+ s amount)))\n        (update tokens id {'supply: new-supply })\n        (emit-event (SUPPLY id new-supply))))\n  )\n\n  (defun enforce-unit:bool (id:string amount:decimal)\n    (let ((p (precision id)))\n    (enforce\n      (= (floor amount p)\n         amount)\n      \"precision violation\"))\n  )\n\n  (defpact transfer-crosschain:bool\n    ( id:string\n      sender:string\n      receiver:string\n      receiver-guard:guard\n      target-chain:string\n      amount:decimal )\n    (step\n      (enforce false \"cross chain not supported\"))\n  )\n\n  (defun account-guard:guard (id:string account:string)\n    (with-read ledger (key id account) { 'guard := g } g)\n  )\n\n  (defun get-token-info:object{kip.token-policy-v2.token-info} (id:string)\n    (with-read tokens id\n     { 'policies := policies:[module{kip.token-policy-v2}]\n     , 'supply := supply:decimal\n     , 'precision := precision:integer\n     , 'uri := uri:string\n     }\n     {\n       'id: id\n       , 'supply: supply\n       , 'precision: precision\n       , 'uri: uri\n       , 'policies: policies\n     } )\n  )\n\n  (defun create-account:bool\n    ( id:string\n      account:string\n      guard:guard\n    )\n    (enforce-reserved account guard)\n    (insert ledger (key id account)\n      { \"balance\" : 0.0\n      , \"guard\"   : guard\n      , \"id\" : id\n      , \"account\" : account\n      })\n    (emit-event (ACCOUNT_GUARD id account guard))\n  )\n\n  (defun create-token-id:string (token-details:object{token-details}\n                                 creation-guard:guard)\n    (format \"t:{}\"\n      [(hash [(format \"{}\" [token-details]) (at 'chain-id (chain-data)) creation-guard])])\n  )\n\n  (defun check-reserved:string (token-id:string)\n    \" Checks token-id for reserved name and returns type if \\\n    \\ found or empty string. Reserved names start with a \\\n    \\ single char and colon, e.g. 't:foo', which would return 't' as type.\"\n    (let ((pfx (take 2 token-id)))\n      (if (= \":\" (take -1 pfx)) (take 1 pfx) \"\")))\n\n  (defun enforce-token-reserved:bool (token-id:string token-details:object{token-details}\n                                      creation-guard:guard)\n    @doc \"Enforce reserved token-id name protocols.\"\n    (let ((r (check-reserved token-id)))\n      (if (= \"t\" r)\n        (enforce\n          (= token-id\n             (create-token-id token-details creation-guard))\n          \"Token protocol violation\")\n        (enforce false\n          (format \"Unrecognized reserved protocol: {}\" [r]) ))))\n\n  (defun enforce-uri-reserved:bool (uri:string)\n    \" Enforce reserved uri name protocols \"\n    (if (= \"marmalade:\" (take 10 uri))\n        (enforce false \"Reserved protocol: marmalade:\")\n        true\n    )\n  )\n\n  (defun truncate:decimal (id:string amount:decimal)\n    (floor amount (precision id))\n  )\n\n  ;;\n  ;; ACCESSORS\n  ;;\n\n  (defun key:string ( id:string account:string )\n    @doc \"DB key for ledger account\"\n    (format \"{}:{}\" [id account])\n  )\n\n  (defun get-balance:decimal (id:string account:string)\n    @doc \"Returns the ACCOUNT balance of the TOKEN\"\n    (at 'balance (read ledger (key id account)))\n  )\n\n  (defun details:object{account-details}\n    ( id:string account:string )\n    @doc \"Returns ACCOUNT information of the TOKEN\"\n    (read ledger (key id account))\n  )\n\n  (defun total-supply:decimal (id:string)\n    @doc \"Returns total SUPPLY of the TOKEN\"\n    (with-default-read tokens id\n      { 'supply : 0.0 }\n      { 'supply := s }\n      s)\n  )\n\n  (defun precision:integer (id:string)\n    @doc \"Returns PRECISION of the TOKEN\"\n    (with-read tokens id\n      { 'precision := precision }\n      precision\n    )\n  )\n\n  (defun get-uri:string (id:string)\n    @doc \"Returns URI of the TOKEN\"\n    (with-read tokens id\n      { 'uri := uri }\n      uri\n    )\n  )\n\n  (defun get-version:integer (id:string)\n    @doc \"Returns Marmalade VERSION of the TOKEN at creation\"\n    (with-default-read versions id\n      {'version: 0 }\n      {'version:= version }\n      (if (< version 1)\n        (with-read tokens id\n          {'id:= id}\n          version\n        )\n        version\n      )\n    )\n  )\n\n  ;;\n  ;; sale\n  ;;\n\n  (defcap SALE:bool\n    (id:string seller:string amount:decimal timeout:integer sale-id:string)\n    @doc \"Wrapper cap/event of SALE of token ID by SELLER of AMOUNT until TIMEOUT block height.\"\n    @event\n    (enforce (> amount 0.0) \"Amount must be positive\")\n    (compose-capability (OFFER id seller amount timeout))\n    (compose-capability (SALE_PRIVATE sale-id))\n  )\n\n  (defcap OFFER:bool\n    (id:string seller:string amount:decimal timeout:integer)\n    @doc \"Managed cap for SELLER offering AMOUNT of token ID until TIMEOUT.\"\n    @managed\n    (enforce (sale-active timeout) \"SALE: invalid timeout\")\n    (compose-capability (DEBIT id seller))\n    (compose-capability (CREDIT id (sale-account)))\n  )\n\n  (defcap WITHDRAW:bool\n    (id:string seller:string amount:decimal timeout:integer sale-id:string)\n    @doc \"Withdraws offer SALE from SELLER of AMOUNT of token ID after timeout.\"\n    @managed\n    (compose-capability (SALE_PRIVATE sale-id))\n    (if (= 0 timeout)\n      (enforce-guard (at 'guard (details id seller)))\n      (enforce (not (sale-active timeout)) \"WITHDRAW: still active\")\n    )\n    (compose-capability (DEBIT id (sale-account)))\n    (compose-capability (CREDIT id seller))\n  )\n\n  (defcap BUY:bool\n    (id:string seller:string buyer:string amount:decimal sale-id:string)\n    @doc \"Completes sale OFFER to BUYER.\"\n    @managed\n    (compose-capability (SALE_PRIVATE sale-id))\n    (compose-capability (DEBIT id (sale-account)))\n    (compose-capability (CREDIT id buyer))\n  )\n\n  (defcap SALE_PRIVATE:bool (sale-id:string) true)\n\n  (defpact sale:string\n    ( id:string\n      seller:string\n      amount:decimal\n      timeout:integer\n    )\n    (step-with-rollback\n      ;; Step 0: offer\n      (let ((token-info (get-token-info id)))\n        (with-capability (OFFER-CALL id seller amount timeout (pact-id))\n          (marmalade-v2.policy-manager.enforce-offer token-info seller amount timeout (pact-id)))\n        (with-capability (SALE id seller amount timeout (pact-id))\n          (offer id seller amount))\n        (pact-id)\n      )\n      ;;Step 0, rollback: withdraw\n      (let ((token-info (get-token-info id)))\n        (with-capability (WITHDRAW-CALL id seller amount timeout (pact-id))\n          (marmalade-v2.policy-manager.enforce-withdraw token-info seller amount timeout (pact-id)))\n        (with-capability (WITHDRAW id seller amount timeout (pact-id))\n          (withdraw id seller amount))\n        (pact-id)\n      )\n    )\n    (step\n      ;; Step 1: buy\n      (let ( (buyer:string (read-msg \"buyer\"))\n              (buyer-guard:guard (read-msg \"buyer-guard\")) )\n          (with-capability (BUY-CALL id seller buyer amount (pact-id))\n            (marmalade-v2.policy-manager.enforce-buy (get-token-info id) seller buyer buyer-guard amount (pact-id))\n          )\n          (with-capability (BUY id seller buyer amount (pact-id))\n            (buy id seller buyer buyer-guard amount)\n          )\n          (pact-id)\n    ))\n  )\n\n  (defun offer:bool\n    ( id:string\n      seller:string\n      amount:decimal\n    )\n    @doc \"Initiate sale with by SELLER by escrowing AMOUNT of TOKEN until TIMEOUT.\"\n    @model\n      [ (property (!= id \"\"))\n        (property (!= seller \"\"))\n        (property (>= amount 0.0))\n      ]\n    (require-capability (SALE_PRIVATE (pact-id)))\n    (let\n      (\n        (sender (debit id seller amount))\n        (receiver (credit id (sale-account) (create-capability-pact-guard (SALE_PRIVATE (pact-id))) amount))\n      )\n      (emit-event (TRANSFER id seller (sale-account) amount))\n      (emit-event (RECONCILE id amount sender receiver)))\n  )\n\n  (defun withdraw:bool\n    ( id:string\n      seller:string\n      amount:decimal\n    )\n    @doc \"Withdraw offer by SELLER of AMOUNT of TOKEN\"\n    @model\n      [ (property (!= id \"\"))\n        (property (!= seller \"\"))\n        (property (>= amount 0.0))\n      ]\n    (require-capability (SALE_PRIVATE (pact-id)))\n    (let\n      (\n        (sender (debit id (sale-account) amount))\n        (receiver (credit-account id seller amount))\n      )\n      (emit-event (TRANSFER id (sale-account) seller amount))\n      (emit-event (RECONCILE id amount sender receiver)))\n  )\n\n  (defun buy:bool\n    ( id:string\n      seller:string\n      buyer:string\n      buyer-guard:guard\n      amount:decimal\n    )\n    @doc \"Complete sale with transfer.\"\n    @model\n      [ (property (!= id \"\"))\n        (property (!= seller \"\"))\n        (property (!= buyer \"\"))\n        (property (>= amount 0.0))\n      ]\n    (require-capability (SALE_PRIVATE (pact-id)))\n    (let\n      (\n        (sender (debit id (sale-account) amount))\n        (receiver (credit id buyer buyer-guard amount))\n      )\n      (emit-event (TRANSFER id (sale-account) buyer amount))\n      (emit-event (RECONCILE id amount sender receiver))\n      true\n  ))\n\n  (defun sale-active:bool (timeout:integer)\n    @doc \"Sale is active until TIMEOUT time.\"\n    (if (= 0 timeout)\n      true\n      (< (at 'block-time (chain-data)) (add-time (time \"1970-01-01T00:00:00Z\") timeout))\n    )\n  )\n\n  (defun sale-account:string ()\n    (create-principal (create-capability-pact-guard (SALE_PRIVATE (pact-id))))\n  )\n)\n\n","meta":{"model":[{"list":[{"atom":"defproperty","q":[],"i":null},{"atom":"valid-account","q":[],"i":null},{"list":[{"atom":"account","q":[],"i":null},{"sep":":","i":null},{"atom":"string","q":[],"i":null}],"d":"()","i":null},{"list":[{"atom":">","q":[],"i":null},{"list":[{"atom":"length","q":[],"i":null},{"atom":"account","q":[],"i":null}],"d":"()","i":null},{"i":null,"lit":{"int":2}}],"d":"()","i":null}],"d":"()","i":null}],"docs":null},"governance":{"capability":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"GOVERNANCE","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}}},"refMap":{"enforce-uri-reserved":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"uri","type":"string","info":null}],"return":"bool"},"defName":"enforce-uri-reserved","defBody":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":"marmalade:"},{"args":[{"i":null,"lit":{"int":10}},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"take"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":false},{"i":null,"lit":"Reserved protocol: marmalade:"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Enforce reserved uri name protocols "},"info":null}},"token-details":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-details","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"TRANSFER-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"TRANSFER-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-transfer"},"info":null}},"check-reserved":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token-id","type":"string","info":null}],"return":"string"},"defName":"check-reserved","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":":"},{"args":[{"i":null,"lit":{"int":-1}},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"take"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":{"int":1}},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"take"}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":""}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"pfx","type":{"tag":"TypeVar","name":"z","constraint":[]},"info":null},"val":{"args":[{"i":null,"lit":{"int":2}},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"take"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Checks token-id for reserved name and returns type if  found or empty string. Reserved names start with a  single char and colon, e.g. 't:foo', which would return 't' as type."},"info":null}},"OFFER-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"OFFER-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-offer"},"info":null}},"update-supply":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"update-supply","defBody":{"scope":{"list":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.UPDATE_SUPPLY.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"supply":{"i":null,"lit":0}},"keyorder":["supply"],"type":"*","i":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null},{"obj":{"supply":{"var":{"b":0},"i":null}},"keyorder":["supply"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SUPPLY.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"new-supply","type":{"tag":"TypeVar","name":"t","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"s","type":{"tag":"TypeVar","name":"s","constraint":[]},"info":null},"val":{"i":null,"lit":"supply"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-default-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"sale-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[],"return":"string"},"defName":"sale-account","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE_PRIVATE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-capability-pact-guard"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-principal"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"create-token":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null},{"name":"creation-guard","type":{"guard":null},"info":null}],"return":"bool"},"defName":"create-token","defBody":{"scope":{"list":[{"args":[{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.enforce-uri-reserved.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.enforce-token-reserved.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"token-details","type":{"tag":"TypeVar","name":"h","constraint":[]},"info":null},"val":{"obj":{"precision":{"var":{"b":1},"i":null},"uri":{"var":{"b":2},"i":null},"policies":{"args":[{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"sort"}},"i":null}},"i":null},"info":null}},"keyorder":["uri","precision","policies"],"type":"*","i":null}}],"type":"let","i":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.INIT-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"obj":{"supply":{"i":null,"lit":0},"precision":{"var":{"b":1},"i":null},"uri":{"var":{"b":2},"i":null},"id":{"var":{"b":0},"i":null},"policies":{"var":{"b":3},"i":null}},"keyorder":["id","supply","precision","uri","policies"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-init.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.CREATE-TOKEN.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"supply":{"i":null,"lit":0},"precision":{"var":{"b":1},"i":null},"uri":{"var":{"b":2},"i":null},"id":{"var":{"b":0},"i":null},"policies":{"var":{"b":3},"i":null}},"keyorder":["id","uri","precision","supply","policies"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"versions","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"version","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"version","type":"integer","info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"version":{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":{"int":1}}},"i":null}},"i":null}},"i":null}},"keyorder":["version"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":3},"i":null},{"var":{"b":2},"i":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TOKEN.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Initializes a TOKEN with given policies and parameters,  and executes the enforce-init function for each listed policy."},"info":null}},"CREATE-TOKEN":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null}],"return":"bool"},"defName":"CREATE-TOKEN","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"enforce-unit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"enforce-unit","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"floor"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"precision violation"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"p","type":{"tag":"TypeVar","name":"u","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.precision.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Enforce that AMOUNT meets minimum precision allowed for ID."},"info":null}},"INIT-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null}],"return":"bool"},"defName":"INIT-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-init "},"info":null}},"tokens":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"offer":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"offer","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE_PRIVATE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.RECONCILE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sender","type":{"tag":"TypeVar","name":"ak","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.debit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}},{"arg":{"name":"receiver","type":{"tag":"TypeVar","name":"al","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE_PRIVATE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"create-capability-pact-guard"}},"i":null}},"i":null},"info":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.credit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"seller","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Initiate sale with by SELLER by escrowing AMOUNT of TOKEN until TIMEOUT."},"info":null}},"OFFER":{"ref":{"defType":"Defcap","defMeta":{"managerAuto":true},"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null}],"return":"bool"},"defName":"OFFER","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-active.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"SALE: invalid timeout"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.DEBIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.CREDIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Managed cap for SELLER offering AMOUNT of token ID until TIMEOUT."},"info":null}},"create-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}],"return":"bool"},"defName":"create-account","defBody":{"scope":{"list":[{"args":[{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.enforce-reserved.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"obj":{"guard":{"var":{"b":2},"i":null},"balance":{"i":null,"lit":0},"account":{"var":{"b":1},"i":null},"id":{"var":{"b":0},"i":null}},"keyorder":["balance","guard","id","account"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"insert"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.ACCOUNT_GUARD.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Create ACCOUNT for ID with 0.0 balance, with GUARD controlling access."},"info":null}},"get-token-info":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"token-policy-v2"},"name":"token-info","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null},{"name":"precision","type":"integer","info":null},{"name":"uri","type":"string","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"}},"defName":"get-token-info","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"body":{"scope":{"list":[{"obj":{"supply":{"var":{"b":1},"i":null},"precision":{"var":{"b":2},"i":null},"uri":{"var":{"b":3},"i":null},"id":{"var":{"f":{"var":{"b":0},"i":null}},"i":null},"policies":{"var":{"b":0},"i":null}},"keyorder":["id","supply","precision","uri","policies"],"type":"*","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"policies","type":{"list":{"modspec":[{"var":{"f":{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}},"i":null}]}},"info":null},"val":{"i":null,"lit":"policies"}},{"arg":{"name":"supply","type":"decimal","info":null},"val":{"i":null,"lit":"supply"}},{"arg":{"name":"precision","type":"integer","info":null},"val":{"i":null,"lit":"precision"}},{"arg":{"name":"uri","type":"string","info":null},"val":{"i":null,"lit":"uri"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"SUPPLY":{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"id","type":"string","info":null},{"name":"supply","type":"decimal","info":null}],"return":"bool"},"defName":"SUPPLY","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Emitted when supply is updated, if supported. Emitted when SUPPLY is updated, if supported."},"info":null}},"ACCOUNT_GUARD":{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null}],"return":"bool"},"defName":"ACCOUNT_GUARD","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Emitted when ACCOUNT guard is updated. Emitted when ACCOUNT guard is updated."},"info":null}},"TOKEN":{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"id","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null},{"name":"uri","type":"string","info":null},{"name":"creation-guard","type":{"guard":null},"info":null}],"return":"bool"},"defName":"TOKEN","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"burn":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"burn","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.BURN-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-token-info.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-burn.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.BURN.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.RECONCILE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"args":[{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.update-supply.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sender","type":{"tag":"TypeVar","name":"j","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.debit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}},{"arg":{"name":"receiver","type":{"schema":"object","type":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"receiver-balance-change","meta":{"model":[],"docs":"For use in RECONCILE events"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"previous","type":"decimal","info":null},{"name":"current","type":"decimal","info":null}]}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"obj":{"account":{"i":null,"lit":""},"current":{"i":null,"lit":0},"previous":{"i":null,"lit":0}},"keyorder":["account","previous","current"],"type":"*","i":null}}],"type":"let","i":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Burns an AMOUNT of TOKEN from the specified ACCOUNT, and executes the enforce-burn policy functions Burn AMOUNT of ID from ACCOUNT."},"info":null}},"BURN":{"ref":{"defType":"Defcap","defMeta":{"managerAuto":true},"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"tag":"TypeVar","name":"g","constraint":[]}},"defName":"BURN","defBody":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":0},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Amount must be positive"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.DEBIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.UPDATE_SUPPLY.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"XTRANSFER":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER-mgr.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"target-chain","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"XTRANSFER","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":false},{"i":null,"lit":"cross chain not supported"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Manage cross-chain transferring AMOUNT of ID from SENDER to RECEIVER  on TARGET-CHAIN."},"info":null}},"DEBIT":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null}],"return":{"tag":"TypeVar","name":"d","constraint":[]}},"defName":"DEBIT","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.account-guard.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"precision":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null}],"return":"integer"},"defName":"precision","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"precision","type":{"tag":"TypeVar","name":"ae","constraint":[]},"info":null},"val":{"i":null,"lit":"precision"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Returns PRECISION of the TOKEN Return maximum decimal precision for ID."},"info":null}},"RECONCILE":{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"token-id","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sender","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"sender-balance-change","meta":{"model":[],"docs":"For use in RECONCILE events"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"previous","type":"decimal","info":null},{"name":"current","type":"decimal","info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"receiver","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"receiver-balance-change","meta":{"model":[],"docs":"For use in RECONCILE events"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"previous","type":"decimal","info":null},{"name":"current","type":"decimal","info":null}]}},"i":null},"partial":"full"},"info":null}],"return":"bool"},"defName":"RECONCILE","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" For accounting via events.  sender = {account: '', previous: 0.0, current: 0.0} for mint  receiver = {account: '', previous: 0.0, current: 0.0} for burn For accounting via events.  sender = {account: '', previous: 0.0, current: 0.0} for mint  receiver = {account: '', previous: 0.0, current: 0.0} for burn"},"info":null}},"truncate":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"decimal"},"defName":"truncate","defBody":{"scope":{"list":[{"args":[{"var":{"b":1},"i":null},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.precision.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"floor"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"debit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"sender-balance-change","meta":{"model":[],"docs":"For use in RECONCILE events"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"previous","type":"decimal","info":null},{"name":"current","type":"decimal","info":null}]}},"i":null},"partial":"full"}},"defName":"debit","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.DEBIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.enforce-unit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"<="}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Insufficient funds"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"obj":{"balance":{"var":{"b":0},"i":null}},"keyorder":["balance"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"obj":{"account":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null},"current":{"var":{"b":0},"i":null},"previous":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"keyorder":["account","previous","current"],"type":"*","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"new-bal","type":{"tag":"TypeVar","name":"q","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"old-bal","type":{"tag":"TypeVar","name":"p","constraint":[]},"info":null},"val":{"i":null,"lit":"balance"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"BUY-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"BUY-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-buy"},"info":null}},"MINT-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"MINT-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-mint"},"info":null}},"credit-account":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"receiver-balance-change","meta":{"model":[],"docs":"For use in RECONCILE events"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"previous","type":"decimal","info":null},{"name":"current","type":"decimal","info":null}]}},"i":null},"partial":"full"}},"defName":"credit-account","defBody":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.account-guard.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.credit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Credit AMOUNT to ACCOUNT"},"info":null}},"versions":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"versions","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"version","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"version","type":"integer","info":null}]}},"i":null},"i":null}},"enforce-token-reserved":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token-id","type":"string","info":null},{"name":"token-details","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-details","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"creation-guard","type":{"guard":null},"info":null}],"return":"bool"},"defName":"enforce-token-reserved","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":"t"},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"args":[{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.create-token-id.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Token protocol violation"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":false},{"args":[{"i":null,"lit":"Unrecognized reserved protocol: {}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"ab","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"r","type":{"tag":"TypeVar","name":"aa","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.check-reserved.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Enforce reserved token-id name protocols."},"info":null}},"BURN-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"BURN-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-burn"},"info":null}},"total-supply":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null}],"return":"decimal"},"defName":"total-supply","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"supply":{"i":null,"lit":0}},"keyorder":["supply"],"type":"*","i":null},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"s","type":{"tag":"TypeVar","name":"ad","constraint":[]},"info":null},"val":{"i":null,"lit":"supply"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-default-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Returns total SUPPLY of the TOKEN Give total available quantity of ID. If not supported, return 0."},"info":null}},"key":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null}],"return":"string"},"defName":"key","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":"{}:{}"},{"list":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"type":{"tag":"TypeVar","name":"ac","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"DB key for ledger account"},"info":null}},"token-schema":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"version":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"version","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"version","type":"integer","info":null}]}},"transfer-create":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"receiver-guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"transfer-create","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null},"info":null},{"i":null,"lit":"sender cannot be the receiver of a transfer"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.precision.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.enforce-valid-transfer.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-token-info.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":1},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.account-guard.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":2},"i":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-transfer.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.RECONCILE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sender","type":{"tag":"TypeVar","name":"n","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.debit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}},{"arg":{"name":"receiver","type":{"tag":"TypeVar","name":"o","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"b":2},"i":null},{"var":{"b":3},"i":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.credit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"sender","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"receiver","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"sender","q":[],"i":null},{"atom":"receiver","q":[],"i":null}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Transfers an AMOUNT of TOKEN from the sender ACCOUNT  to the receiver ACCOUNT, creates an account if non-existent  , and executes the enforce-transfer policy functions. Transfer AMOUNT of ID between accounts SENDER and RECEIVER.  If RECEIVER exists, RECEIVER-GUARD must match existing guard;  if RECEIVER does not exist, account is created.  Managed by TRANSFER."},"info":null}},"update-uri":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"new-uri","type":"string","info":null}],"return":"bool"},"defName":"update-uri","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":{"int":0}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":"updatable-uri not supported"}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"version","type":"integer","info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-version.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.UPDATE-URI-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-token-info.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-update-uri.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.UPDATE-URI.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"uri":{"var":{"b":1},"i":null}},"keyorder":["uri"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"update"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Updates the URI of the token, and executes enforce-update-uri  policy functions."},"info":null}},"VERSION":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"arg":{"name":"VERSION","type":"integer","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":{"int":1}},"eval":{"var":{"direct":{"pdval":{"int":1}}},"i":null}},"i":null}},"WITHDRAW":{"ref":{"defType":"Defcap","defMeta":{"managerAuto":true},"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"WITHDRAW","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE_PRIVATE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":{"int":0}},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":"guard"},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.details.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"args":[{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-active.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"not"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"WITHDRAW: still active"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.DEBIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.CREDIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Withdraws offer SALE from SELLER of AMOUNT of token ID after timeout."},"info":null}},"sale-active":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"timeout","type":"integer","info":null}],"return":"bool"},"defName":"sale-active","defBody":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":{"int":0}},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null},"info":null},{"i":null,"lit":true},{"args":[{"args":[{"i":null,"lit":"block-time"},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"chain-data"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"i":null,"lit":"1970-01-01T00:00:00Z"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"time"}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"add-time"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Sale is active until TIMEOUT time."},"info":null}},"withdraw":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"withdraw","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE_PRIVATE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.RECONCILE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sender","type":{"tag":"TypeVar","name":"am","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.debit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}},{"arg":{"name":"receiver","type":{"tag":"TypeVar","name":"an","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.credit-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"seller","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Withdraw offer by SELLER of AMOUNT of TOKEN"},"info":null}},"details":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"partial":"full"}},"defName":"details","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Returns ACCOUNT information of the TOKEN Get details of ACCOUNT under ID. Fails if account does not exist."},"info":null}},"create-token-id":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"token-details","type":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-details","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"partial":"full"},"info":null},{"name":"creation-guard","type":{"guard":null},"info":null}],"return":"string"},"defName":"create-token-id","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":"t:{}"},{"list":[{"args":[{"list":[{"args":[{"i":null,"lit":"{}"},{"list":[{"var":{"b":0},"i":null}],"type":{"tag":"TypeVar","name":"w","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"chain-id"},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"chain-data"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null},{"var":{"b":1},"i":null}],"type":{"tag":"TypeVar","name":"x","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"hash"}},"i":null}},"i":null},"info":null}],"type":{"tag":"TypeVar","name":"y","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"ADMIN-KS":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"arg":{"name":"ADMIN-KS","type":"string","info":null},"meta":{"model":[],"docs":null},"val":{"raw":{"i":null,"lit":"marmalade-v2.marmalade-contract-admin"},"eval":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"UPDATE-URI":{"ref":{"defType":"Defcap","defMeta":{"managerAuto":true},"funType":{"args":[{"name":"token-id","type":"string","info":null},{"name":"new-uri","type":"string","info":null}],"return":"bool"},"defName":"UPDATE-URI","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"credit":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null}],"return":{"schema":"object","type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"receiver-balance-change","meta":{"model":[],"docs":"For use in RECONCILE events"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"previous","type":"decimal","info":null},{"name":"current","type":"decimal","info":null}]}},"i":null},"partial":"full"}},"defName":"credit","defBody":{"scope":{"list":[{"args":[{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.enforce-reserved.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.enforce-unit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.CREDIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"obj":{"balance":{"i":null,"lit":-1}},"keyorder":["balance"],"type":"*","i":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"obj":{"guard":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"balance":{"var":{"b":0},"i":null},"account":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"id":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"keyorder":["balance","guard","id","account"],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"write"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null},{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":2},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.ACCOUNT_GUARD.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null},{"obj":{"account":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":1},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"current":{"var":{"b":0},"i":null},"previous":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"keyorder":["account","previous","current"],"type":"*","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"new-bal","type":"decimal","info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"b":3},"i":null}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"+"}},"i":null}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"old-bal","type":"decimal","info":null},"val":{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":0},{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"is-new","type":"bool","info":null},"val":{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":-1}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"="}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"old-bal","type":{"tag":"TypeVar","name":"r","constraint":[]},"info":null},"val":{"i":null,"lit":"balance"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-default-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"valid-account","q":[],"i":null},{"atom":"account","q":[],"i":null}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Credit AMOUNT to ACCOUNT balance"},"info":null}},"get-balance":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null}],"return":"decimal"},"defName":"get-balance","defBody":{"scope":{"list":[{"args":[{"i":null,"lit":"balance"},{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"at"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Returns the ACCOUNT balance of the TOKEN Get balance of ID for ACCOUNT. Fails if account does not exist."},"info":null}},"CREDIT":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"receiver","type":"string","info":null}],"return":{"tag":"TypeVar","name":"e","constraint":[]}},"defName":"CREDIT","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"ledger":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"WITHDRAW-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"WITHDRAW-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-withdraw"},"info":null}},"UPDATE-URI-CALL":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"new-uri","type":"string","info":null}],"return":"bool"},"defName":"UPDATE-URI-CALL","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Capability securing the modref call for enforce-update-uri"},"info":null}},"UPDATE_SUPPLY":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"f","constraint":[]}},"defName":"UPDATE_SUPPLY","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"private cap for update-supply"},"info":null}},"transfer-crosschain":{"ref":{"defType":"Defpact","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"receiver-guard","type":{"guard":null},"info":null},{"name":"target-chain","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"transfer-crosschain","defBody":{"scope":{"list":[{"body":{"exec":{"args":[{"i":null,"lit":false},{"i":null,"lit":"cross chain not supported"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},"rollback":null,"entity":null,"info":null},"meta":{"model":[],"docs":null},"i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"sender","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"receiver","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"target-chain","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Transfer AMOUNT of ID between accounts SENDER on source chain  and RECEIVER on TARGET-CHAIN. If RECEIVER exists, RECEIVER-GUARD  must match existing guard. If RECEIVER does not exist, account is created."},"info":null}},"get-uri":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null}],"return":"string"},"defName":"get-uri","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"uri","type":{"tag":"TypeVar","name":"af","constraint":[]},"info":null},"val":{"i":null,"lit":"uri"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Returns URI of the TOKEN Give uri for ID."},"info":null}},"sale":{"ref":{"defType":"Defpact","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null}],"return":"string"},"defName":"sale","defBody":{"scope":{"list":[{"body":{"exec":{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.OFFER-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-offer.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.offer.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"token-info","type":{"tag":"TypeVar","name":"ai","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-token-info.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},"rollback":{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.WITHDRAW-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"b":0},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-withdraw.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.WITHDRAW.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.withdraw.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"token-info","type":{"tag":"TypeVar","name":"aj","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-token-info.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},"entity":null,"info":null},"meta":{"model":[],"docs":null},"i":null},{"body":{"exec":{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.BUY-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-token-info.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-buy.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.BUY.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.buy.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"buyer","type":"string","info":null},"val":{"args":[{"i":null,"lit":"buyer"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null},"info":null}},{"arg":{"name":"buyer-guard","type":{"guard":null},"info":null},"val":{"args":[{"i":null,"lit":"buyer-guard"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"read-msg"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null},"rollback":null,"entity":null,"info":null},"meta":{"model":[],"docs":null},"i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Offer->buy escrow pact of AMOUNT of token ID by SELLER with TIMEOUT in blocks.  Step 1 is offer with withdraw rollback after timeout.  Step 2 is buy, which completes using 'buyer' and 'buyer-guard' payload values."},"info":null}},"TRANSFER":{"ref":{"defType":"Defcap","defMeta":{"managedParam":"amount","managerFun":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER-mgr.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"TRANSFER","defBody":{"scope":{"list":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.enforce-unit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":3},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Amount must be positive"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.DEBIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.CREDIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Manage transferring AMOUNT of ID from SENDER to RECEIVER.  As event, also used to notify burn (with \"\" RECEIVER)  and create (with \"\" SENDER)."},"info":null}},"transfer":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"sender","type":"string","info":null},{"name":"receiver","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"transfer","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":1},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"!="}},"i":null}},"i":null},"info":null},{"i":null,"lit":"sender cannot be the receiver of a transfer"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.precision.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"util.fungible-util.enforce-valid-transfer.{UQLJbAuAQXFUDIKUdxfHSMKpxn7KgK2QqLKoUDcJ6qA}"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-token-info.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":1},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.account-guard.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":2},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-transfer.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"f":{"var":{"b":0},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"f":{"var":{"b":3},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.RECONCILE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sender","type":{"tag":"TypeVar","name":"l","constraint":[]},"info":null},"val":{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":1},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.debit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}},{"arg":{"name":"receiver","type":{"tag":"TypeVar","name":"m","constraint":[]},"info":null},"val":{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.credit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"k","constraint":[]},"info":null},"val":{"i":null,"lit":"guard"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"sender","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"receiver","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"sender","q":[],"i":null},{"atom":"receiver","q":[],"i":null}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Transfers an AMOUNT of TOKEN from the sender ACCOUNT  to an existing receiver ACCOUNT, and executes the enforce-transfer  policy functions. Transfer AMOUNT of ID between accounts SENDER and RECEIVER.  Fails if SENDER does not exist. Managed by TRANSFER."},"info":null}},"SALE":{"ref":{"defType":"Defcap","defMeta":"event","funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"timeout","type":"integer","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"SALE","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":2},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":">"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Amount must be positive"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.OFFER.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE_PRIVATE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Wrapper cap/event of SALE of token ID by SELLER of AMOUNT until TIMEOUT block height.Wrapper cap/event of SALE of token ID by SELLER of AMOUNT until TIMEOUT block height."},"info":null}},"buy":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"buyer-guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"buy","defBody":{"scope":{"list":[{"args":[{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"pact-id"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE_PRIVATE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"require-capability"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"f":{"var":{"b":2},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.TRANSFER.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":4},"i":null}},"i":null},{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.RECONCILE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null},{"i":null,"lit":true}],"type":"*","i":null}},"pairs":[{"arg":{"name":"sender","type":{"tag":"TypeVar","name":"ao","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.debit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}},{"arg":{"name":"receiver","type":{"tag":"TypeVar","name":"ap","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"b":2},"i":null},{"var":{"b":3},"i":null},{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.credit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"seller","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"buyer","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Complete sale with transfer."},"info":null}},"mint":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"guard","type":{"guard":null},"info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"mint","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.MINT-CALL.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"args":[{"args":[{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.get-token-info.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.policy-manager.enforce-mint.{h6JuhF9udyeGA1UCdLZBqQKEJdswsB-vYh1Dl-k462o}"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.MINT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null},{"var":{"b":1},"i":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.RECONCILE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"emit-event"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"var":{"f":{"var":{"b":3},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.update-supply.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"receiver","type":{"tag":"TypeVar","name":"i","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null},{"var":{"b":2},"i":null},{"var":{"b":3},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.credit.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}},{"arg":{"name":"sender","type":{"schema":"object","type":{"var":{"f":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"sender-balance-change","meta":{"model":[],"docs":"For use in RECONCILE events"},"i":null,"fields":[{"name":"account","type":"string","info":null},{"name":"previous","type":"decimal","info":null},{"name":"current","type":"decimal","info":null}]}},"i":null}},"i":null},"partial":"full"},"info":null},"val":{"obj":{"account":{"i":null,"lit":""},"current":{"i":null,"lit":0},"previous":{"i":null,"lit":0}},"keyorder":["account","previous","current"],"type":"*","i":null}}],"type":"let","i":null}],"type":"*","i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"property","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"amount","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":"Mints an AMOUNT of TOKEN to the provided ACCOUNT and its guard, and executes the enforce-mint policy functions. Mint AMOUNT of ID to ACCOUNT with GUARD."},"info":null}},"MINT":{"ref":{"defType":"Defcap","defMeta":{"managerAuto":true},"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"amount","type":"decimal","info":null}],"return":"bool"},"defName":"MINT","defBody":{"scope":{"list":[{"args":[{"args":[{"i":null,"lit":0},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null},"info":null},{"i":null,"lit":"Amount must be positive"}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.CREDIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.UPDATE_SUPPLY.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"BUY":{"ref":{"defType":"Defcap","defMeta":{"managerAuto":true},"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"seller","type":"string","info":null},{"name":"buyer","type":"string","info":null},{"name":"amount","type":"decimal","info":null},{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"BUY","defBody":{"scope":{"list":[{"args":[{"args":[{"var":{"b":4},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.SALE_PRIVATE.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"args":[],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.sale-account.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.DEBIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null},{"args":[{"args":[{"var":{"b":0},"i":null},{"var":{"b":2},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.CREDIT.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"compose-capability"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Completes sale OFFER to BUYER."},"info":null}},"TRANSFER-mgr":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"managed","type":"decimal","info":null},{"name":"requested","type":"decimal","info":null}],"return":"decimal"},"defName":"TRANSFER-mgr","defBody":{"scope":{"list":[{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":0}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":">="}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"i":null,"lit":"TRANSFER exceeded for balance {}"},{"list":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"type":{"tag":"TypeVar","name":"c","constraint":[]},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"format"}},"i":null}},"i":null}},"i":null},"info":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"enforce"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"newbal","type":{"tag":"TypeVar","name":"b","constraint":[]},"info":null},"val":{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"-"}},"i":null}},"i":null},"info":null}}],"type":"let","i":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":" Manages TRANSFER cap AMOUNT where MANAGED is the installed quantity  and REQUESTED is the quantity attempting to be granted."},"info":null}},"GOVERNANCE":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[],"return":{"tag":"TypeVar","name":"a","constraint":[]}},"defName":"GOVERNANCE","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"var":{"direct":{"pdval":"marmalade-v2.marmalade-contract-admin"}},"i":null}},"i":null}},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"enforce-guard"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"get-version":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null}],"return":"integer"},"defName":"get-version","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"versions","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"version","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"version","type":"integer","info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"var":{"b":0},"i":null},{"obj":{"version":{"i":null,"lit":{"int":0}}},"keyorder":["version"],"type":"*","i":null},{"body":{"scope":{"list":[{"args":[{"args":[{"var":{"b":0},"i":null},{"i":null,"lit":{"int":1}}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"<"}},"i":null}},"i":null}},"i":null},"info":null},{"args":[{"var":{"f":{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"tokens","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"token-schema","meta":{"model":[],"docs":null},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"uri","type":"string","info":null},{"name":"precision","type":"integer","info":null},{"name":"supply","type":"decimal","info":null},{"name":"policies","type":{"list":{"modspec":[{"var":{"ref":{"refSpec":null,"refInfo":null,"refName":{"namespace":"kip","name":"token-policy-v2"}}},"i":null}]}},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null}},"i":null},{"var":{"f":{"var":{"b":0},"i":null}},"i":null},{"body":{"scope":{"list":[{"var":{"f":{"var":{"b":0},"i":null}},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"id","type":{"tag":"TypeVar","name":"ah","constraint":[]},"info":null},"val":{"i":null,"lit":"id"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null}},"i":null},"info":null},{"var":{"b":0},"i":null}],"fun":{"var":{"f":{"var":{"f":{"var":{"direct":{"pdnat":"if"}},"i":null}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"version","type":{"tag":"TypeVar","name":"ag","constraint":[]},"info":null},"val":{"i":null,"lit":"version"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-default-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":"Returns Marmalade VERSION of the TOKEN at creation"},"info":null}},"SALE_PRIVATE":{"ref":{"defType":"Defcap","defMeta":null,"funType":{"args":[{"name":"sale-id","type":"string","info":null}],"return":"bool"},"defName":"SALE_PRIVATE","defBody":{"scope":{"list":[{"i":null,"lit":true}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}},"account-guard":{"ref":{"defType":"Defun","defMeta":null,"funType":{"args":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null}],"return":{"guard":null}},"defName":"account-guard","defBody":{"scope":{"list":[{"args":[{"var":{"f":{"var":{"ref":{"hash":"PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8","modname":{"namespace":"marmalade-v2","name":"ledger"},"name":"ledger","meta":{"model":[],"docs":null},"type":{"var":{"ref":{"modname":{"namespace":"kip","name":"poly-fungible-v3"},"name":"account-details","meta":{"model":[{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"id","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":"!=","q":[],"i":null},{"atom":"account","q":[],"i":null},{"i":null,"lit":""}],"d":"()","i":null}],"d":"()","i":null},{"list":[{"atom":"invariant","q":[],"i":null},{"list":[{"atom":">=","q":[],"i":null},{"atom":"balance","q":[],"i":null},{"i":null,"lit":0}],"d":"()","i":null}],"d":"()","i":null}],"docs":" Account details: token ID, account name, balance, and guard."},"i":null,"fields":[{"name":"id","type":"string","info":null},{"name":"account","type":"string","info":null},{"name":"balance","type":"decimal","info":null},{"name":"guard","type":{"guard":null},"info":null}]}},"i":null},"i":null}},"i":null}},"i":null},{"args":[{"var":{"b":0},"i":null},{"var":{"b":1},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdfv":"marmalade-v2.ledger.key.{PFOzg5nF1lqLnn4y17wQNEG8a6BjP7i_I7c3FmL-Ql8}"}},"i":null}},"i":null},"info":null},{"body":{"scope":{"list":[{"var":{"b":0},"i":null}],"type":"*","i":null}},"pairs":[{"arg":{"name":"g","type":{"tag":"TypeVar","name":"v","constraint":[]},"info":null},"val":{"i":null,"lit":"guard"}}],"type":{"bind":"*"},"i":null}],"fun":{"var":{"f":{"var":{"direct":{"pdnat":"with-read"}},"i":null}},"i":null},"info":null}],"type":"*","i":null}},"module":{"namespace":"marmalade-v2","name":"ledger"},"meta":{"model":[],"docs":null},"info":null}}}}
